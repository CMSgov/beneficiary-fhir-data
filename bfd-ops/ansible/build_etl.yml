---
##
# Configures the LSS zone's build server (e.g. Jenkins).
##
    - hosts: pipeline_box
      tasks:
        - include_role:
            name: karlmdavis.bluebutton_data_pipeline
          vars:
            data_pipeline_appjar_name: bluebutton-data-pipeline-app-0.1.0-SNAPSHOT-capsule-fat.jar
            data_pipeline_appjar_localpath: /home/karlmdavis/workspaces/cms/bluebutton-data-pipeline.git/bluebutton-data-pipeline-app/target
            data_pipeline_s3_bucket: name-of-the-s3-bucket-with-the-data-to-process
            data_pipeline_hicn_hash_iterations: "{{ vault_data_pipeline_hicn_hash_iterations }}"
            data_pipeline_hicn_hash_pepper: "{{ vault_data_pipeline_hicn_hash_pepper }}"
            data_pipeline_db_url: 'jdbc:postgresql://mydbserver.example.com:5432/mydb'
            data_pipeline_db_username: "{{ vault_data_pipeline_db_username }}"
            data_pipeline_db_password: "{{ vault_data_pipeline_db_password }}"
- name: Install and Configure Data Pipeline Server
  hosts: all
  user: ec2-user
  become: true
  gather_facts: no
  vars_files:
    - host_vars/builds.bfd-mgmt.cmscloud.local/vault.yml
  vars:
    ansible_ssh_pipelining: no

  tasks:
    - import_role:
        name: rhel_prep
    - import_role:
        name: install_epel_repo
     - import_role:
         name: base_patch
