- inputPath: ExplanationOfBenefit-Pharmacy.CLM_UNIQ_ID
  appliesTo:
    - Pharmacy
  sources:
    - NCH
  sourceView: V2_MDCR_CLM
  sourceColumn: CLM_UNIQ_ID
  fhirPath: ExplanationOfBenefit.identifier.where(type.coding.system = 'http://hl7.org/fhir/us/carin-bb/CodeSystem/C4BBIdentifierType' and type.coding.code = 'uc' ).value
- inputPath: ExplanationOfBenefit-Pharmacy.CLM_ORIG_CNTL_NUM
  appliesTo:
    - Pharmacy
  sources:
    - NCH
  sourceView: V2_MDCR_CLM
  sourceColumn: CLM_ORIG_CNTL_NUM
  fhirPath: ExplanationOfBenefit.identifier.where(system = 'https://bluebutton.cms.gov/identifiers/CLM-CNTL-NUM').value
- inputPath: ExplanationOfBenefit-Pharmacy.CLM_TYPE_CD
  appliesTo:
    - Pharmacy
  sources:
    - NCH
  sourceView: V2_MDCR_CLM
  sourceColumn: CLM_TYPE_CD
  fhirPath: ExplanationOfBenefit.type.coding.where(system = 'https://bluebutton.cms.gov/fhir/CodeSystem/CLM-TYPE-CD').code
- inputPath: ExplanationOfBenefit-Pharmacy.CLM_BENE_XREF_EFCTV_SK
  appliesTo:
    - Pharmacy
  sources:
    - NCH
  bfdDerived: True
  fhirPath: ExplanationOfBenefit.patient.reference.substring(8)
- inputPath: ExplanationOfBenefit-Pharmacy.CLM_FROM_DT
  appliesTo:
    - Pharmacy
  sources:
    - NCH
  sourceView: V2_MDCR_CLM
  sourceColumn: CLM_FROM_DT
  fhirPath: ExplanationOfBenefit.billablePeriod.start
- inputPath: ExplanationOfBenefit-Pharmacy.CLM_THRU_DT
  appliesTo:
    - Pharmacy
  sources:
    - NCH
  sourceView: V2_MDCR_CLM
  sourceColumn: CLM_THRU_DT
  fhirPath: ExplanationOfBenefit.billablePeriod.end
- inputPath: ExplanationOfBenefit-Pharmacy.CLM_EFCTV_DT
  appliesTo:
    - Pharmacy
  sources:
    - NCH
  sourceView: V2_MDCR_CLM
  sourceColumn: CLM_EFCTV_DT
  fhirPath: ExplanationOfBenefit.created
- inputPath: ExplanationOfBenefit-Pharmacy.CLM_SRC_ID
  appliesTo:
    - Pharmacy
  sources:
    - NCH
  sourceView: V2_MDCR_CLM
  sourceColumn: CLM_SRC_ID
  fhirPath: ExplanationOfBenefit.meta.source
- inputPath: ExplanationOfBenefit-Pharmacy.CLM_SRVC_PRVDR_GNRC_ID_NUM
  appliesTo:
    - Pharmacy
  sources:
    - NCH
  sourceView: V2_MDCR_CLM
  sourceColumn: CLM_SRVC_PRVDR_GNRC_ID_NUM
  fhirPath: ExplanationOfBenefit.contained.where(id = %root.provider.reference.substring(1)).identifier.where(system='http://hl7.org/fhir/sid/us-npi').value
- inputPath: ExplanationOfBenefit-Pharmacy.clm_srvc_prvdr_gnrc_id_type
  appliesTo:
    - Pharmacy
  sources:
    - NCH
  bfdDerived: True
- inputPath: ExplanationOfBenefit-Pharmacy.PRVDR_PRSCRBNG_PRVDR_NPI_NUM
  appliesTo:
    - Pharmacy
  sources:
    - NCH
  sourceView: V2_MDCR_CLM
  sourceColumn: PRVDR_PRSCRBNG_PRVDR_NPI_NUM
  fhirPath: ExplanationOfBenefit.contained.where(id = %root.careTeam.where(role.coding.code='prescribing').provider.reference.substring(1)).identifier.where(system='http://hl7.org/fhir/sid/us-npi').value
- inputPath: ExplanationOfBenefit-Pharmacy.PRVDR_PRSCRBNG_PRVDR_NPI_TYPE
  appliesTo:
    - Pharmacy
  sources:
    - NCH
  bfdDerived: True
- inputPath: ExplanationOfBenefit-Pharmacy.PRVDR_PRSCRBNG_PRVDR_LAST_NAME
  appliesTo:
    - Pharmacy
  sources:
    - NCH
  bfdDerived: True
  fhirPath: ExplanationOfBenefit.contained.where(id = %root.careTeam.where(role.coding.code='prescribing').provider.reference.substring(1)).name.family
- inputPath: ExplanationOfBenefit-Pharmacy.CLM_PD_DT
  appliesTo:
    - Pharmacy
  sources:
    - NCH
  sourceView: V2_MDCR_CLM
  sourceColumn: CLM_PD_DT
  fhirPath: ExplanationOfBenefit.payment.date
- inputPath: ExplanationOfBenefit-Pharmacy.CLM_CMS_PROC_DT
  appliesTo:
    - Pharmacy
  sources:
    - NCH
  sourceView: V2_MDCR_CLM
  sourceColumn: CLM_CMS_PROC_DT
  fhirPath: ExplanationOfBenefit.extension.where(url='https://bluebutton.cms.gov/fhir/StructureDefinition/CLM-CMS-PROC-DT').value
- inputPath: ExplanationOfBenefit-Pharmacy.CLM_SBMT_FRMT_CD
  appliesTo:
    - Pharmacy
  sources:
    - NCH
  sourceView: V2_MDCR_CLM
  sourceColumn: CLM_SBMT_FRMT_CD
  fhirPath: ExplanationOfBenefit.extension.where(url='https://bluebutton.cms.gov/fhir/StructureDefinition/CLM-SBMT-FRMT-CD').valueCoding.code
- inputPath: ExplanationOfBenefit-Pharmacy.CLM_SBMT_CHRG_AMT
  appliesTo:
    - Pharmacy
  sources:
    - NCH
  sourceView: V2_MDCR_CLM
  sourceColumn: CLM_SBMT_CHRG_AMT
  fhirPath: ExplanationOfBenefit.total.where(category.coding.where(system='http://terminology.hl7.org/CodeSystem/adjudication' and code='submitted')).amount.value
- inputPath: ExplanationOfBenefit-Pharmacy.CLM_SBMTR_CNTRCT_NUM
  appliesTo:
    - Pharmacy
  sources:
    - NCH
  sourceView: V2_MDCR_CLM
  sourceColumn: CLM_SBMTR_CNTRCT_NUM
  fhirPath: ExplanationOfBenefit.insurance.extension.where(url='https://bluebutton.cms.gov/fhir/StructureDefinition/CLM-SBMTR-CNTRCT-NUM').value
- inputPath: ExplanationOfBenefit-Pharmacy.CLM_SBMTR_CNTRCT_PBP_NUM
  appliesTo:
    - Pharmacy
  sources:
    - NCH
  sourceView: V2_MDCR_CLM
  sourceColumn: CLM_SBMTR_CNTRCT_PBP_NUM
  fhirPath: ExplanationOfBenefit.insurance.extension.where(url='https://bluebutton.cms.gov/fhir/StructureDefinition/CLM-SBMTR-CNTRCT-PBP-NUM').value
- inputPath: ExplanationOfBenefit-Pharmacy.CNTRCT_PBP_NAME
  appliesTo:
    - Pharmacy
  sources:
    - NCH
  sourceView: V2_MDCR_CNTRCT_PBP_NUM
  sourceColumn: CNTRCT_PBP_NAME
  fhirPath: ExplanationOfBenefit.contained.where(id='insurer-org').name
- inputPath: LineItemComponent.CLM_LINE_NUM
  appliesTo:
    - Pharmacy
  sources:
    - NCH
  sourceView: V2_MDCR_CLM
  sourceColumn: CLM_LINE_NUM
  fhirPath: ExplanationOfBenefit.item.sequence
- inputPath: LineItemComponent.CLM_LINE_FROM_DT
  appliesTo:
    - Pharmacy
  sources:
    - NCH
  sourceView: V2_MDCR_CLM_LINE
  sourceColumn: CLM_LINE_FROM_DT
  fhirPath: ExplanationOfBenefit.item.serviced
- inputPath: LineItemComponent.CLM_LINE_NDC_CD
  appliesTo:
    - Pharmacy
  sources:
    - NCH
  sourceView: V2_MDCR_CLM_LINE
  sourceColumn: CLM_LINE_NDC_CD
  fhirPath: ExplanationOfBenefit.item.productOrService.coding.where(system='http://hl7.org/fhir/sid/ndc').code
- inputPath: LineItemComponent.CLM_LINE_NDC_QTY
  appliesTo:
    - Pharmacy
  sources:
    - NCH
  sourceView: V2_MDCR_CLM_LINE
  sourceColumn: CLM_LINE_NDC_QTY
  fhirPath: ExplanationOfBenefit.item.quantity.value
- inputPath: LineItemComponent.CLM_LINE_NDC_QTY_QLFYR_CD
  appliesTo:
    - Pharmacy
  sources:
    - NCH
  sourceView: V2_MDCR_CLM_LINE
  sourceColumn: CLM_LINE_NDC_QTY_QLFYR_CD
  fhirPath: ExplanationOfBenefit.item.quantity.unit
- inputPath: LineItemComponent.CLM_LINE_CVRD_PD_AMT
  appliesTo:
    - Pharmacy
  sources:
    - NCH
  sourceView: V2_MDCR_CLM_LINE
  sourceColumn: CLM_LINE_CVRD_PD_AMT
  fhirPath: ExplanationOfBenefit.item.adjudication.where(category.coding.where(system='http://terminology.hl7.org/CodeSystem/adjudication' and code='benefit').exists()).amount.value
- inputPath: LineItemComponent.CLM_LINE_NCVRD_CHRG_AMT
  appliesTo:
    - Pharmacy
  sources:
    - NCH
  sourceView: V2_MDCR_CLM_LINE
  sourceColumn: CLM_LINE_NCVRD_CHRG_AMT
  fhirPath: ExplanationOfBenefit.item.adjudication.where(category.coding.where(system='http://hl7.org/fhir/us/carin-bb/CodeSystem/C4BBAdjudication' and code='noncovered').exists()).amount.value
- inputPath: LineItemComponent.CLM_LINE_BENE_PD_AMT
  appliesTo:
    - Pharmacy
  sources:
    - NCH
  sourceView: V2_MDCR_CLM_LINE
  sourceColumn: CLM_LINE_BENE_PD_AMT
  fhirPath: ExplanationOfBenefit.item.adjudication.where(category.coding.where(system='http://hl7.org/fhir/us/carin-bb/CodeSystem/C4BBAdjudication' and code='paidbypatient').exists()).amount.value
- inputPath: LineItemComponent.CLM_LINE_PRVDR_PMT_AMT
  appliesTo:
    - Pharmacy
  sources:
    - NCH
  sourceView: V2_MDCR_CLM_LINE
  sourceColumn: CLM_LINE_PRVDR_PMT_AMT
  fhirPath: ExplanationOfBenefit.item.adjudication.where(category.coding.where(system='http://hl7.org/fhir/us/carin-bb/CodeSystem/C4BBAdjudication' and code='paidtoprovider').exists()).amount.value
- inputPath: LineItemComponent.CLM_LINE_GRS_ABOVE_THRSHLD_AMT
  appliesTo:
    - Pharmacy
  sources:
    - NCH
  sourceView: V2_MDCR_CLM_LINE_RX
  sourceColumn: CLM_LINE_GRS_ABOVE_THRSHLD_AMT
  fhirPath: ExplanationOfBenefit.item.adjudication.where(category.coding.system='https://bluebutton.cms.gov/fhir/CodeSystem/Adjudication' and category.coding.code='CLM_LINE_GRS_ABOVE_THRSHLD_AMT').amount.value
- inputPath: LineItemComponent.CLM_LINE_GRS_BLW_THRSHLD_AMT
  appliesTo:
    - Pharmacy
  sources:
    - NCH
  sourceView: V2_MDCR_CLM_LINE_RX
  sourceColumn: CLM_LINE_GRS_BLW_THRSHLD_AMT
  fhirPath: ExplanationOfBenefit.item.adjudication.where(category.coding.system='https://bluebutton.cms.gov/fhir/CodeSystem/Adjudication' and category.coding.code='CLM_LINE_GRS_BLW_THRSHLD_AMT').amount.value
- inputPath: LineItemComponent.CLM_LINE_LIS_AMT
  appliesTo:
    - Pharmacy
  sources:
    - NCH
  sourceView: V2_MDCR_CLM_LINE_RX
  sourceColumn: CLM_LINE_LIS_AMT
  fhirPath: ExplanationOfBenefit.item.adjudication.where(category.coding.system='https://bluebutton.cms.gov/fhir/CodeSystem/Adjudication' and category.coding.code='CLM_LINE_LIS_AMT').amount.value
- inputPath: LineItemComponent.CLM_LINE_TROOP_TOT_AMT
  appliesTo:
    - Pharmacy
  sources:
    - NCH
  sourceView: V2_MDCR_CLM_LINE_RX
  sourceColumn: CLM_LINE_TROOP_TOT_AMT
  fhirPath: ExplanationOfBenefit.item.adjudication.where(category.coding.system='https://bluebutton.cms.gov/fhir/CodeSystem/Adjudication' and category.coding.code='CLM_LINE_TROOP_TOT_AMT').amount.value
- inputPath: LineItemComponent.CLM_LINE_PLRO_AMT
  appliesTo:
    - Pharmacy
  sources:
    - NCH
  sourceView: V2_MDCR_CLM_LINE_RX
  sourceColumn: CLM_LINE_PLRO_AMT
  fhirPath: ExplanationOfBenefit.item.adjudication.where(category.coding.system='https://bluebutton.cms.gov/fhir/CodeSystem/Adjudication' and category.coding.code='CLM_LINE_PLRO_AMT').amount.value
- inputPath: LineItemComponent.CLM_RPTD_MFTR_DSCNT_AMT
  appliesTo:
    - Pharmacy
  sources:
    - NCH
  sourceView: V2_MDCR_CLM_LINE_RX
  sourceColumn: CLM_RPTD_MFTR_DSCNT_AMT
  fhirPath: ExplanationOfBenefit.item.adjudication.where(category.coding.system='https://bluebutton.cms.gov/fhir/CodeSystem/Adjudication' and category.coding.code='CLM_RPTD_MFTR_DSCNT_AMT').amount.value
- inputPath: LineItemComponent.CLM_LINE_INGRDNT_CST_AMT
  appliesTo:
    - Pharmacy
  sources:
    - NCH
  sourceView: V2_MDCR_CLM_LINE_RX
  sourceColumn: CLM_LINE_INGRDNT_CST_AMT
  fhirPath: ExplanationOfBenefit.item.adjudication.where(category.coding.system='https://bluebutton.cms.gov/fhir/CodeSystem/Adjudication' and category.coding.code='CLM_LINE_INGRDNT_CST_AMT').amount.value
- inputPath: LineItemComponent.CLM_LINE_SRVC_CST_AMT
  appliesTo:
    - Pharmacy
  sources:
    - NCH
  sourceView: V2_MDCR_CLM_LINE_RX
  sourceColumn: CLM_LINE_SRVC_CST_AMT
  fhirPath: ExplanationOfBenefit.item.adjudication.where(category.coding.system='https://bluebutton.cms.gov/fhir/CodeSystem/Adjudication' and category.coding.code='CLM_LINE_SRVC_CST_AMT').amount.value
- inputPath: LineItemComponent.CLM_LINE_SLS_TAX_AMT
  appliesTo:
    - Pharmacy
  sources:
    - NCH
  sourceView: V2_MDCR_CLM_LINE_RX
  sourceColumn: CLM_LINE_SLS_TAX_AMT
  fhirPath: ExplanationOfBenefit.item.adjudication.where(category.coding.system='https://bluebutton.cms.gov/fhir/CodeSystem/Adjudication' and category.coding.code='CLM_LINE_SLS_TAX_AMT').amount.value
- inputPath: LineItemComponent.CLM_LINE_VCCN_ADMIN_FEE_AMT
  appliesTo:
    - Pharmacy
  sources:
    - NCH
  sourceView: V2_MDCR_CLM_LINE_RX
  sourceColumn: CLM_LINE_VCCN_ADMIN_FEE_AMT
  fhirPath: ExplanationOfBenefit.item.adjudication.where(category.coding.system='https://bluebutton.cms.gov/fhir/CodeSystem/Adjudication' and category.coding.code='CLM_LINE_VCCN_ADMIN_FEE_AMT').amount.value
- inputPath: LineItemComponent.CLM_PRCNG_EXCPTN_CD
  appliesTo:
    - Pharmacy
  sources:
    - NCH
  sourceView: V2_MDCR_CLM_LINE_RX
  sourceColumn: CLM_PRCNG_EXCPTN_CD
  fhirPath: ExplanationOfBenefit.adjudication.where(category.coding.where(system='http://hl7.org/fhir/us/carin-bb/CodeSystem/C4BBAdjudicationDiscriminator' and code='benefitpaymentstatus').exists()).reason.coding.where(system='http://hl7.org/fhir/us/carin-bb/CodeSystem/C4BBPayerAdjudicationStatus').code
- inputPath: SupportingInfoComponent.CLM_LINE_AUTHRZD_FILL_NUM
  appliesTo:
    - Pharmacy
  sources:
    - NCH
  sourceView: V2_MDCR_CLM_LINE_RX
  sourceColumn: CLM_LINE_AUTHRZD_FILL_NUM
  fhirPath: ExplanationOfBenefit.supportingInfo.where(category.coding.system='http://hl7.org/fhir/us/carin-bb/CodeSystem/C4BBSupportingInfoType' and category.coding.code='refillsauthorized').valueQuantity.value
- inputPath: SupportingInfoComponent.CLM_PHRMCY_SRVC_TYPE_CD
  appliesTo:
    - Pharmacy
  sources:
    - NCH
  sourceView: V2_MDCR_CLM_LINE_RX
  sourceColumn: CLM_PHRMCY_SRVC_TYPE_CD
  fhirPath: ExplanationOfBenefit.supportingInfo.where(category.coding.where(system='https://bluebutton.cms.gov/fhir/CodeSystem/Supporting-Information' and code='CLM_PHRMCY_SRVC_TYPE_CD').exists()).code.coding.where(system='https://bluebutton.cms.gov/fhir/CodeSystem/CLM-PHRMCY-SRVC-TYPE-CD').code
- inputPath: SupportingInfoComponent.CLM_LINE_RX_ORGN_CD
  appliesTo:
    - Pharmacy
  sources:
    - NCH
  sourceView: V2_MDCR_CLM_LINE_RX
  sourceColumn: CLM_LINE_RX_ORGN_CD
  fhirPath: ExplanationOfBenefit.supportingInfo.where(category.coding.where(system='http://hl7.org/fhir/us/carin-bb/CodeSystem/C4BBSupportingInfoType' and code='rxorigincode').exists()).code.coding.where(system='http://terminology.hl7.org/CodeSystem/NCPDPPrescriptionOriginCode').code
- inputPath: SupportingInfoComponent.CLM_BRND_GNRC_CD
  appliesTo:
    - Pharmacy
  sources:
    - NCH
  sourceView: V2_MDCR_CLM_LINE_RX
  sourceColumn: CLM_BRND_GNRC_CD
  fhirPath: ExplanationOfBenefit.supportingInfo.where(category.coding.where(system='http://hl7.org/fhir/us/carin-bb/CodeSystem/C4BBSupportingInfoType' and code='brandgenericindicator').exists()).code.coding.where(system='http://terminology.hl7.org/CodeSystem/NCPDPBrandGenericIndicator').code
- inputPath: SupportingInfoComponent.CLM_PTNT_RSDNC_CD
  appliesTo:
    - Pharmacy
  sources:
    - NCH
  sourceView: V2_MDCR_CLM_LINE_RX
  sourceColumn: CLM_PTNT_RSDNC_CD
  fhirPath: ExplanationOfBenefit.supportingInfo.code.coding.where(system='https://bluebutton.cms.gov/fhir/CodeSystem/CLM-PTNT-RSDNC-CD').code
- inputPath: SupportingInfoComponent.CLM_LTC_DSPNSNG_MTHD_CD
  appliesTo:
    - Pharmacy
  sources:
    - NCH
  sourceView: V2_MDCR_CLM_LINE_RX
  sourceColumn: CLM_LTC_DSPNSNG_MTHD_CD
  fhirPath: ExplanationOfBenefit.supportingInfo.code.coding.where(system='https://bluebutton.cms.gov/fhir/CodeSystem/CLM-LTC-DSPNSNG-MTHD-CD').code 
- inputPath: SupportingInfoComponent.CLM_CMPND_CD
  appliesTo:
    - Pharmacy
  sources:
    - NCH
  sourceView: V2_MDCR_CLM_LINE_RX
  sourceColumn: CLM_CMPND_CD
  fhirPath: ExplanationOfBenefit.supportingInfo.where(category.coding.where(system='http://hl7.org/fhir/us/carin-bb/CodeSystem/C4BBSupportingInfoType' and code='compoundcode').exists()).code.coding.where(system='http://terminology.hl7.org/CodeSystem/NCPDPCompoundCode').code
- inputPath: SupportingInfoComponent.CLM_LINE_DAYS_SUPLY_QTY
  appliesTo:
    - Pharmacy
  sources:
    - NCH
  sourceView: V2_MDCR_CLM_LINE_RX
  sourceColumn: CLM_LINE_DAYS_SUPLY_QTY
  fhirPath: ExplanationOfBenefit.supportingInfo.where(category.coding.where(system='http://hl7.org/fhir/us/carin-bb/CodeSystem/C4BBSupportingInfoType' and code='dayssupply').exists()).valueQuantity.value
- inputPath: SupportingInfoComponent.CLM_LINE_RX_FILL_NUM
  appliesTo:
    - Pharmacy
  sources:
    - NCH
  sourceView: V2_MDCR_CLM_LINE_RX
  sourceColumn: CLM_LINE_RX_FILL_NUM
  fhirPath: ExplanationOfBenefit.supportingInfo.where(category.coding.where(system='http://hl7.org/fhir/us/carin-bb/CodeSystem/C4BBSupportingInfoType' and code='refillnum').exists()).valueQuantity.value
- inputPath: SupportingInfoComponent.CLM_DAW_PROD_SLCTN_CD
  appliesTo:
    - Pharmacy
  sources:
    - NCH
  sourceView: V2_MDCR_CLM_LINE_RX
  sourceColumn: CLM_DAW_PROD_SLCTN_CD
  fhirPath: ExplanationOfBenefit.supportingInfo.code.coding.where(system='http://terminology.hl7.org/CodeSystem/NCPDPDispensedAsWrittenOrProductSelectionCode').code 
- inputPath: SupportingInfoComponent.CLM_DRUG_CVRG_STUS_CD
  appliesTo:
    - Pharmacy
  sources:
    - NCH
  sourceView: V2_MDCR_CLM_LINE_RX
  sourceColumn: CLM_DRUG_CVRG_STUS_CD
  fhirPath: ExplanationOfBenefit.supportingInfo.code.coding.where(system='https://bluebutton.cms.gov/fhir/CodeSystem/CLM-DRUG-CVRG-STUS-CD').code 
- inputPath: SupportingInfoComponent.CLM_CTSTRPHC_CVRG_IND_CD
  appliesTo:
    - Pharmacy
  sources:
    - NCH
  sourceView: V2_MDCR_CLM_LINE_RX
  sourceColumn: CLM_CTSTRPHC_CVRG_IND_CD
  fhirPath: ExplanationOfBenefit.supportingInfo.code.coding.where(system='https://bluebutton.cms.gov/fhir/CodeSystem/CLM-CTSTRPHC-CVRG-IND-CD').code 
