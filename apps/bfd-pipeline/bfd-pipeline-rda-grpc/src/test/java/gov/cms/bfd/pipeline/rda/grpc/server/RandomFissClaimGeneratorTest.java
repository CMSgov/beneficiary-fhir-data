package gov.cms.bfd.pipeline.rda.grpc.server;

import static gov.cms.bfd.pipeline.rda.grpc.server.AbstractRandomClaimGeneratorTest.countDistinctFieldValues;
import static gov.cms.bfd.pipeline.rda.grpc.server.AbstractRandomClaimGeneratorTest.maxFieldLength;
import static org.hamcrest.MatcherAssert.assertThat;
import static org.junit.jupiter.api.Assertions.assertEquals;

import com.google.protobuf.InvalidProtocolBufferException;
import com.google.protobuf.util.JsonFormat;
import gov.cms.mpsm.rda.v1.fiss.FissClaim;
import java.time.Clock;
import java.time.Instant;
import java.time.ZoneOffset;
import java.util.stream.Collectors;
import java.util.stream.IntStream;
import org.hamcrest.Matchers;
import org.junit.jupiter.api.Test;

/** Unit tests for the {@link RandomFissClaimGenerator}. */
public class RandomFissClaimGeneratorTest {

  /**
   * Asserts that given a set seed and clock, the random generator creates an expected claim for
   * ensuring that tests using a randomly generated claim will be repeatable.
   *
   * @throws InvalidProtocolBufferException if there is an issue turning the generated claim into
   *     json for comparison
   */
  @Test
  public void randomClaim() throws InvalidProtocolBufferException {
    final Clock july1 = Clock.fixed(Instant.ofEpochMilli(1625172944844L), ZoneOffset.UTC);
    final RandomFissClaimGenerator generator =
        new RandomFissClaimGenerator(
            RandomClaimGeneratorConfig.builder()
                .seed(1)
                .optionalOverride(true)
                .clock(july1)
                .build());
    final FissClaim claim = generator.randomClaim();
    final String json = JsonFormat.printer().print(claim);
    assertEquals(
        "{\n"
            + "  \"dcn\": \"79347185903055953987254\",\n"
            + "  \"hicNo\": \"618367226005\",\n"
            + "  \"currStatusEnum\": \"CLAIM_STATUS_ROUTING\",\n"
            + "  \"currLoc1Enum\": \"PROCESSING_TYPE_OFFLINE\",\n"
            + "  \"currLoc2Enum\": \"CURRENT_LOCATION_2_POST_PAY_7573\",\n"
            + "  \"provStateCd\": \"k8\",\n"
            + "  \"provTypFacilCd\": \"w\",\n"
            + "  \"provEmerInd\": \"m\",\n"
            + "  \"provDeptId\": \"mkm\",\n"
            + "  \"totalChargeAmount\": \"4879.67\",\n"
            + "  \"recdDtCymd\": \"2021-02-07\",\n"
            + "  \"currTranDtCymd\": \"2021-01-20\",\n"
            + "  \"admDiagCode\": \"hrp\",\n"
            + "  \"principleDiag\": \"rkfdh\",\n"
            + "  \"npiNumber\": \"2581678565\",\n"
            + "  \"mbi\": \"bd1n31sbbrq\",\n"
            + "  \"fedTaxNb\": \"4725636111\",\n"
            + "  \"fissProcCodes\": [{\n"
            + "    \"procCd\": \"rkfdh\",\n"
            + "    \"rdaPosition\": 1,\n"
            + "    \"procFlag\": \"hn\",\n"
            + "    \"procDt\": \"2021-02-15\"\n"
            + "  }, {\n"
            + "    \"procCd\": \"b\",\n"
            + "    \"rdaPosition\": 2,\n"
            + "    \"procFlag\": \"p\",\n"
            + "    \"procDt\": \"2021-04-11\"\n"
            + "  }, {\n"
            + "    \"procCd\": \"xstrzvw\",\n"
            + "    \"rdaPosition\": 3,\n"
            + "    \"procFlag\": \"pxxs\",\n"
            + "    \"procDt\": \"2021-02-06\"\n"
            + "  }, {\n"
            + "    \"procCd\": \"rdvbd\",\n"
            + "    \"rdaPosition\": 4,\n"
            + "    \"procFlag\": \"jh\",\n"
            + "    \"procDt\": \"2021-04-22\"\n"
            + "  }, {\n"
            + "    \"procCd\": \"h\",\n"
            + "    \"rdaPosition\": 5,\n"
            + "    \"procFlag\": \"qx\",\n"
            + "    \"procDt\": \"2021-04-02\"\n"
            + "  }, {\n"
            + "    \"procCd\": \"jvd\",\n"
            + "    \"rdaPosition\": 6,\n"
            + "    \"procFlag\": \"x\",\n"
            + "    \"procDt\": \"2021-04-06\"\n"
            + "  }],\n"
            + "  \"medaProvId\": \"3gt5j5ckm3v24\",\n"
            + "  \"pracLocAddr1\": \"5q20q9db0z4gv7\",\n"
            + "  \"pracLocAddr2\": \"k3m4d6t1g9hj7wpg10sr3m4xsfdkvb69h7tvx0nt7px8c2c9hkg0fn646b44jmskpwd2g7xc522w6xzmdsp26rds8gpd8rrd5p6p\",\n"
            + "  \"pracLocCity\": \"x2x6cqbh59f762hrnfdjq2ntqq\",\n"
            + "  \"pracLocState\": \"kj\",\n"
            + "  \"pracLocZip\": \"14735937\",\n"
            + "  \"fissDiagCodes\": [{\n"
            + "    \"diagCd2\": \"zq\",\n"
            + "    \"bitFlags\": \"vfjk\",\n"
            + "    \"diagPoaIndUnrecognized\": \"x\",\n"
            + "    \"rdaPosition\": 1\n"
            + "  }, {\n"
            + "    \"diagCd2\": \"ghnhhzj\",\n"
            + "    \"diagPoaIndEnum\": \"DIAGNOSIS_PRESENT_ON_ADMISSION_INDICATOR_YES\",\n"
            + "    \"bitFlags\": \"cjsn\",\n"
            + "    \"rdaPosition\": 2\n"
            + "  }, {\n"
            + "    \"diagCd2\": \"bvcqwpr\",\n"
            + "    \"diagPoaIndEnum\": \"DIAGNOSIS_PRESENT_ON_ADMISSION_INDICATOR_UNREPORTED\",\n"
            + "    \"bitFlags\": \"kpmd\",\n"
            + "    \"rdaPosition\": 3\n"
            + "  }, {\n"
            + "    \"diagCd2\": \"xkvkf\",\n"
            + "    \"diagPoaIndEnum\": \"DIAGNOSIS_PRESENT_ON_ADMISSION_INDICATOR_CLINICALLY_UNDETERMINED\",\n"
            + "    \"bitFlags\": \"svf\",\n"
            + "    \"rdaPosition\": 4\n"
            + "  }, {\n"
            + "    \"diagCd2\": \"jkns\",\n"
            + "    \"diagPoaIndEnum\": \"DIAGNOSIS_PRESENT_ON_ADMISSION_INDICATOR_CLINICALLY_UNDETERMINED\",\n"
            + "    \"bitFlags\": \"hgnz\",\n"
            + "    \"rdaPosition\": 5\n"
            + "  }, {\n"
            + "    \"diagCd2\": \"ccpfxmk\",\n"
            + "    \"diagPoaIndEnum\": \"DIAGNOSIS_PRESENT_ON_ADMISSION_INDICATOR_CLINICALLY_UNDETERMINED\",\n"
            + "    \"bitFlags\": \"gp\",\n"
            + "    \"rdaPosition\": 6\n"
            + "  }],\n"
            + "  \"stmtCovFromCymd\": \"2021-03-17\",\n"
            + "  \"stmtCovToCymd\": \"2021-04-23\",\n"
            + "  \"medaProv6\": \"3gt5j5\",\n"
            + "  \"lobCdEnum\": \"BILL_FACILITY_TYPE_INTERMEDIATE_CASE\",\n"
            + "  \"servTypeCdForClinicsEnum\": \"BILL_CLASSIFICATION_FOR_CLINICS_OPIOID_TREATMENT_PROGRAM\",\n"
            + "  \"freqCdUnrecognized\": \"b\",\n"
            + "  \"billTypCd\": \"q88\",\n"
            + "  \"fissPayers\": [{\n"
            + "    \"insuredPayer\": {\n"
            + "      \"rdaPosition\": 1,\n"
            + "      \"payersIdEnum\": \"PAYERS_CODE_BLACK_LUNG\",\n"
            + "      \"payersName\": \"ksfvnjfdqmvdfqm\",\n"
            + "      \"relIndEnum\": \"RELEASE_OF_INFORMATION_SIGNED_STATEMENT_WAS_OBTAINED\",\n"
            + "      \"assignIndEnum\": \"ASSIGNMENT_OF_BENEFITS_INDICATOR_BENEFITS_ASSIGNED\",\n"
            + "      \"providerNumber\": \"tzggwdnbbxr\",\n"
            + "      \"adjDcnIcn\": \"xfpcdgtbtkfmxcxnqxwbhtg\",\n"
            + "      \"priorPmt\": \"48.50\",\n"
            + "      \"estAmtDue\": \"27684.64\",\n"
            + "      \"insuredRelUnrecognized\": \"23\",\n"
            + "      \"insuredName\": \"ngzpjnzfzpnxqtxkm\",\n"
            + "      \"insuredSsnHic\": \"k\",\n"
            + "      \"insuredGroupName\": \"rvwvnzwcpxjmm\",\n"
            + "      \"insuredGroupNbr\": \"tmbcfxsrnxb\",\n"
            + "      \"treatAuthCd\": \"s7g279ntxbwk\",\n"
            + "      \"insuredSexUnrecognized\": \"r\",\n"
            + "      \"insuredRelX12Unrecognized\": \"21\",\n"
            + "      \"insuredDob\": \"2021-06-22\",\n"
            + "      \"insuredDobText\": \"06222021\"\n"
            + "    }\n"
            + "  }, {\n"
            + "    \"insuredPayer\": {\n"
            + "      \"rdaPosition\": 2,\n"
            + "      \"payersIdUnrecognized\": \"h\",\n"
            + "      \"payersName\": \"kjpxrjgk\",\n"
            + "      \"relIndEnum\": \"RELEASE_OF_INFORMATION_SIGNED_STATEMENT_WAS_OBTAINED\",\n"
            + "      \"assignIndUnrecognized\": \"t\",\n"
            + "      \"providerNumber\": \"xrqjqxrbxr\",\n"
            + "      \"adjDcnIcn\": \"rtfqfsdxvbnqfgkzgfmbjnj\",\n"
            + "      \"priorPmt\": \"9740.67\",\n"
            + "      \"estAmtDue\": \"597.06\",\n"
            + "      \"insuredRelUnrecognized\": \"88\",\n"
            + "      \"insuredName\": \"r\",\n"
            + "      \"insuredSsnHic\": \"rcctzcwwjrscrqkn\",\n"
            + "      \"insuredGroupName\": \"qmtnmxbxfngh\",\n"
            + "      \"insuredGroupNbr\": \"tthftwdwxjprvrsphcr\",\n"
            + "      \"treatAuthCd\": \"851b1zr47jz7p585d\",\n"
            + "      \"insuredSexEnum\": \"BENEFICIARY_SEX_FEMALE\",\n"
            + "      \"insuredRelX12Unrecognized\": \"14\",\n"
            + "      \"insuredDob\": \"2021-01-18\",\n"
            + "      \"insuredDobText\": \"01182021\"\n"
            + "    }\n"
            + "  }, {\n"
            + "    \"insuredPayer\": {\n"
            + "      \"rdaPosition\": 3,\n"
            + "      \"payersIdEnum\": \"PAYERS_CODE_BLACK_LUNG\",\n"
            + "      \"payersName\": \"sxgvjhbqdvkzcbbrrzjnbfsdvthbdtx\",\n"
            + "      \"relIndEnum\": \"RELEASE_OF_INFORMATION_NO_RELEASE_ON_FILE\",\n"
            + "      \"assignIndEnum\": \"ASSIGNMENT_OF_BENEFITS_INDICATOR_BENEFITS_ASSIGNED\",\n"
            + "      \"providerNumber\": \"wxwcbghwpcfr\",\n"
            + "      \"adjDcnIcn\": \"kmxjvqbwvfpggrbphwxgdvc\",\n"
            + "      \"priorPmt\": \"5.94\",\n"
            + "      \"estAmtDue\": \"1594.06\",\n"
            + "      \"insuredRelUnrecognized\": \"82\",\n"
            + "      \"insuredName\": \"tnpcvrvwmjmfhchmjffssf\",\n"
            + "      \"insuredSsnHic\": \"qvh\",\n"
            + "      \"insuredGroupName\": \"vc\",\n"
            + "      \"insuredGroupNbr\": \"bbnbqpjvxq\",\n"
            + "      \"treatAuthCd\": \"1gk4hm82t7c\",\n"
            + "      \"insuredSexUnrecognized\": \"w\",\n"
            + "      \"insuredRelX12Unrecognized\": \"83\",\n"
            + "      \"insuredDob\": \"2021-06-25\",\n"
            + "      \"insuredDobText\": \"06252021\"\n"
            + "    }\n"
            + "  }, {\n"
            + "    \"beneZPayer\": {\n"
            + "      \"rdaPosition\": 4,\n"
            + "      \"payersIdUnrecognized\": \"t\",\n"
            + "      \"payersName\": \"hj8x\",\n"
            + "      \"relIndEnum\": \"RELEASE_OF_INFORMATION_NO_RELEASE_ON_FILE\",\n"
            + "      \"assignIndUnrecognized\": \"d\",\n"
            + "      \"providerNumber\": \"2bz9p9gckd\",\n"
            + "      \"adjDcnIcn\": \"80h3d1\",\n"
            + "      \"priorPmt\": \"1.06\",\n"
            + "      \"estAmtDue\": \"978.17\",\n"
            + "      \"beneRelUnrecognized\": \"68\",\n"
            + "      \"beneLastName\": \"thjdmtwcbzn\",\n"
            + "      \"beneFirstName\": \"zsnsdt\",\n"
            + "      \"beneMidInit\": \"p\",\n"
            + "      \"beneSsnHic\": \"9b22bfr\",\n"
            + "      \"insuredGroupName\": \"gkwkxbvbgc\",\n"
            + "      \"beneDob\": \"2021-02-23\",\n"
            + "      \"beneSexUnrecognized\": \"p\",\n"
            + "      \"treatAuthCd\": \"d\",\n"
            + "      \"insuredSexUnrecognized\": \"g\",\n"
            + "      \"insuredRelX12Enum\": \"PATIENT_RELATIONSHIP_CODE_RESERVED_FOR_NATIONAL_ASSIGNMENT_65\"\n"
            + "    }\n"
            + "  }, {\n"
            + "    \"beneZPayer\": {\n"
            + "      \"rdaPosition\": 5,\n"
            + "      \"payersIdEnum\": \"PAYERS_CODE_PUBLIC_HEALTH_SERVICE_OR_OTHER_FEDERAL_AGENCY\",\n"
            + "      \"payersName\": \"vr\",\n"
            + "      \"relIndUnrecognized\": \"x\",\n"
            + "      \"assignIndEnum\": \"ASSIGNMENT_OF_BENEFITS_INDICATOR_BENEFITS_ASSIGNED\",\n"
            + "      \"providerNumber\": \"npnmc3m\",\n"
            + "      \"adjDcnIcn\": \"b29mm021b68w7dtbww\",\n"
            + "      \"priorPmt\": \"106.82\",\n"
            + "      \"estAmtDue\": \"804.14\",\n"
            + "      \"beneRelEnum\": \"PATIENT_RELATIONSHIP_CODE_RESERVED_FOR_NATIONAL_ASSIGNMENT_81\",\n"
            + "      \"beneLastName\": \"qrwx\",\n"
            + "      \"beneFirstName\": \"mgwptv\",\n"
            + "      \"beneMidInit\": \"f\",\n"
            + "      \"beneSsnHic\": \"q5hb34\",\n"
            + "      \"insuredGroupName\": \"gxhsczcspsvc\",\n"
            + "      \"beneDob\": \"2021-01-27\",\n"
            + "      \"beneSexEnum\": \"BENEFICIARY_SEX_MALE\",\n"
            + "      \"treatAuthCd\": \"d\",\n"
            + "      \"insuredSexUnrecognized\": \"n\",\n"
            + "      \"insuredRelX12Unrecognized\": \"55\"\n"
            + "    }\n"
            + "  }],\n"
            + "  \"fissAuditTrail\": [{\n"
            + "    \"badtStatusUnrecognized\": \"h\",\n"
            + "    \"badtLoc\": \"t\",\n"
            + "    \"badtOperId\": \"w32kw1\",\n"
            + "    \"badtReas\": \"6kthk\",\n"
            + "    \"badtCurrDateCymd\": \"2021-04-14\",\n"
            + "    \"rdaPosition\": 1\n"
            + "  }, {\n"
            + "    \"badtStatusEnum\": \"CLAIM_STATUS_SUSPEND\",\n"
            + "    \"badtLoc\": \"m59kj\",\n"
            + "    \"badtOperId\": \"d0\",\n"
            + "    \"badtReas\": \"94\",\n"
            + "    \"badtCurrDateCymd\": \"2021-06-26\",\n"
            + "    \"rdaPosition\": 2\n"
            + "  }, {\n"
            + "    \"badtStatusUnrecognized\": \"w\",\n"
            + "    \"badtLoc\": \"ng\",\n"
            + "    \"badtOperId\": \"s7\",\n"
            + "    \"badtReas\": \"5c623\",\n"
            + "    \"badtCurrDateCymd\": \"2021-01-27\",\n"
            + "    \"rdaPosition\": 3\n"
            + "  }, {\n"
            + "    \"badtStatusEnum\": \"CLAIM_STATUS_RETURN_TO_PRO\",\n"
            + "    \"badtLoc\": \"hfg9\",\n"
            + "    \"badtOperId\": \"pj306\",\n"
            + "    \"badtReas\": \"08b8g\",\n"
            + "    \"badtCurrDateCymd\": \"2021-02-22\",\n"
            + "    \"rdaPosition\": 4\n"
            + "  }, {\n"
            + "    \"badtStatusUnrecognized\": \"x\",\n"
            + "    \"badtLoc\": \"7sdb4\",\n"
            + "    \"badtOperId\": \"ppv\",\n"
            + "    \"badtReas\": \"h\",\n"
            + "    \"badtCurrDateCymd\": \"2021-03-12\",\n"
            + "    \"rdaPosition\": 5\n"
            + "  }, {\n"
            + "    \"badtStatusEnum\": \"CLAIM_STATUS_ROUTING\",\n"
            + "    \"badtLoc\": \"wq8q\",\n"
            + "    \"badtOperId\": \"43sdchx\",\n"
            + "    \"badtReas\": \"mkh\",\n"
            + "    \"badtCurrDateCymd\": \"2021-04-26\",\n"
            + "    \"rdaPosition\": 6\n"
            + "  }, {\n"
            + "    \"badtStatusUnrecognized\": \"j\",\n"
            + "    \"badtLoc\": \"4ff\",\n"
            + "    \"badtOperId\": \"fqj6gm656\",\n"
            + "    \"badtReas\": \"t\",\n"
            + "    \"badtCurrDateCymd\": \"2021-05-04\",\n"
            + "    \"rdaPosition\": 7\n"
            + "  }, {\n"
            + "    \"badtStatusUnrecognized\": \"3\",\n"
            + "    \"badtLoc\": \"08\",\n"
            + "    \"badtOperId\": \"pdrxm\",\n"
            + "    \"badtReas\": \"2m\",\n"
            + "    \"badtCurrDateCymd\": \"2021-02-05\",\n"
            + "    \"rdaPosition\": 8\n"
            + "  }, {\n"
            + "    \"badtStatusEnum\": \"CLAIM_STATUS_INACTIVE\",\n"
            + "    \"badtLoc\": \"dkd\",\n"
            + "    \"badtOperId\": \"btz7dk4pn\",\n"
            + "    \"badtReas\": \"4\",\n"
            + "    \"badtCurrDateCymd\": \"2021-02-09\",\n"
            + "    \"rdaPosition\": 9\n"
            + "  }, {\n"
            + "    \"badtStatusUnrecognized\": \"3\",\n"
            + "    \"badtLoc\": \"rf33f\",\n"
            + "    \"badtOperId\": \"03\",\n"
            + "    \"badtReas\": \"9n\",\n"
            + "    \"badtCurrDateCymd\": \"2021-06-03\",\n"
            + "    \"rdaPosition\": 10\n"
            + "  }, {\n"
            + "    \"badtStatusUnrecognized\": \"g\",\n"
            + "    \"badtLoc\": \"hk\",\n"
            + "    \"badtOperId\": \"56g7nz6\",\n"
            + "    \"badtReas\": \"n5\",\n"
            + "    \"badtCurrDateCymd\": \"2021-03-04\",\n"
            + "    \"rdaPosition\": 11\n"
            + "  }, {\n"
            + "    \"badtStatusUnrecognized\": \"t\",\n"
            + "    \"badtLoc\": \"j\",\n"
            + "    \"badtOperId\": \"rkrr71z5\",\n"
            + "    \"badtReas\": \"mk\",\n"
            + "    \"badtCurrDateCymd\": \"2021-02-19\",\n"
            + "    \"rdaPosition\": 12\n"
            + "  }, {\n"
            + "    \"badtStatusUnrecognized\": \"r\",\n"
            + "    \"badtLoc\": \"7\",\n"
            + "    \"badtOperId\": \"23\",\n"
            + "    \"badtReas\": \"33\",\n"
            + "    \"badtCurrDateCymd\": \"2021-04-04\",\n"
            + "    \"rdaPosition\": 13\n"
            + "  }, {\n"
            + "    \"badtStatusUnrecognized\": \"9\",\n"
            + "    \"badtLoc\": \"d\",\n"
            + "    \"badtOperId\": \"qxcnp\",\n"
            + "    \"badtReas\": \"3n\",\n"
            + "    \"badtCurrDateCymd\": \"2021-02-20\",\n"
            + "    \"rdaPosition\": 14\n"
            + "  }, {\n"
            + "    \"badtStatusEnum\": \"CLAIM_STATUS_ROUTING\",\n"
            + "    \"badtLoc\": \"qswqx\",\n"
            + "    \"badtOperId\": \"t104bjgc\",\n"
            + "    \"badtReas\": \"n\",\n"
            + "    \"badtCurrDateCymd\": \"2021-04-17\",\n"
            + "    \"rdaPosition\": 15\n"
            + "  }, {\n"
            + "    \"badtStatusEnum\": \"CLAIM_STATUS_MOVE\",\n"
            + "    \"badtLoc\": \"p\",\n"
            + "    \"badtOperId\": \"bcr66s8hv\",\n"
            + "    \"badtReas\": \"kn4q8\",\n"
            + "    \"badtCurrDateCymd\": \"2021-06-28\",\n"
            + "    \"rdaPosition\": 16\n"
            + "  }],\n"
            + "  \"rejectCd\": \"9fk6f\",\n"
            + "  \"fullPartDenInd\": \"k\",\n"
            + "  \"nonPayInd\": \"7\",\n"
            + "  \"xrefDcnNbr\": \"9g6cdt7\",\n"
            + "  \"adjReqCdUnrecognized\": \"q\",\n"
            + "  \"adjReasCd\": \"d\",\n"
            + "  \"cancelXrefDcn\": \"6s1f7xf9mghjr\",\n"
            + "  \"cancelDateCymd\": \"2021-03-21\",\n"
            + "  \"cancAdjCdUnrecognized\": \"k\",\n"
            + "  \"originalXrefDcn\": \"69khdgd6x0c4mb\",\n"
            + "  \"paidDtCymd\": \"2021-06-05\",\n"
            + "  \"admDateCymd\": \"2021-04-18\",\n"
            + "  \"admSourceUnrecognized\": \"p\",\n"
            + "  \"primaryPayerCodeUnrecognized\": \"2\",\n"
            + "  \"attendPhysId\": \"n\",\n"
            + "  \"attendPhysLname\": \"91bk27x96z8g\",\n"
            + "  \"attendPhysFname\": \"vvrw\",\n"
            + "  \"attendPhysMint\": \"v\",\n"
            + "  \"attendPhysFlagEnum\": \"PHYSICIAN_FLAG_NO\",\n"
            + "  \"operatingPhysId\": \"n13\",\n"
            + "  \"operPhysLname\": \"9qrpp2d\",\n"
            + "  \"operPhysFname\": \"330vttqqqmbmcbf\",\n"
            + "  \"operPhysMint\": \"s\",\n"
            + "  \"operPhysFlagEnum\": \"PHYSICIAN_FLAG_NO\",\n"
            + "  \"othPhysId\": \"58b\",\n"
            + "  \"othPhysLname\": \"x3rnt1f8c246td6h3\",\n"
            + "  \"othPhysFname\": \"pwg5\",\n"
            + "  \"othPhysMint\": \"8\",\n"
            + "  \"othPhysFlagEnum\": \"PHYSICIAN_FLAG_NO\",\n"
            + "  \"xrefHicNbr\": \"bhc8xt3\",\n"
            + "  \"procNewHicIndUnrecognized\": \"0\",\n"
            + "  \"newHic\": \"jdnbrt9\",\n"
            + "  \"reposIndEnum\": \"REPOSITORY_INDICATOR_NOT_APPLICABLE\",\n"
            + "  \"reposHic\": \"w5m3wx\",\n"
            + "  \"mbiSubmBeneIndEnum\": \"FISS_HIC_OR_MBI_IS_HIC\",\n"
            + "  \"adjMbiIndEnum\": \"ADJUSTMENT_MBI_INDICATOR_MBI_SUBMITTED_ON_ADJUSTMENT_OR_CANCEL_CLAIM\",\n"
            + "  \"adjMbi\": \"m532pp5pxkf\",\n"
            + "  \"medicalRecordNo\": \"x08jk412t\",\n"
            + "  \"stmtCovFromCymdText\": \"2021-03-17\",\n"
            + "  \"stmtCovToCymdText\": \"2021-04-23\",\n"
            + "  \"admDateCymdText\": \"2021-04-18\",\n"
            + "  \"fissRevenueLines\": [{\n"
            + "    \"rdaPosition\": 1,\n"
            + "    \"nonBillRevCodeEnum\": \"NON_BILL_S\",\n"
            + "    \"revCd\": \"dvd\",\n"
            + "    \"revUnitsBilled\": 19,\n"
            + "    \"revServUnitCnt\": 23,\n"
            + "    \"servDtCymd\": \"2021-04-24\",\n"
            + "    \"servDtCymdText\": \"2021-04-24\",\n"
            + "    \"hcpcCd\": \"w\",\n"
            + "    \"hcpcInd\": \"d\",\n"
            + "    \"hcpcModifier\": \"h\",\n"
            + "    \"hcpcModifier2\": \"f\",\n"
            + "    \"hcpcModifier3\": \"5\",\n"
            + "    \"hcpcModifier4\": \"1\",\n"
            + "    \"hcpcModifier5\": \"2\",\n"
            + "    \"acoRedRarc\": \"z\",\n"
            + "    \"acoRedCarc\": \"q\",\n"
            + "    \"acoRedCagc\": \"3x\"\n"
            + "  }, {\n"
            + "    \"rdaPosition\": 2,\n"
            + "    \"nonBillRevCodeUnrecognized\": \"7\",\n"
            + "    \"revCd\": \"2h\",\n"
            + "    \"revUnitsBilled\": 21,\n"
            + "    \"revServUnitCnt\": 28,\n"
            + "    \"servDtCymd\": \"2021-04-09\",\n"
            + "    \"servDtCymdText\": \"2021-04-09\",\n"
            + "    \"hcpcCd\": \"s0h3\",\n"
            + "    \"hcpcInd\": \"b\",\n"
            + "    \"hcpcModifier\": \"z9\",\n"
            + "    \"hcpcModifier2\": \"j\",\n"
            + "    \"hcpcModifier3\": \"5\",\n"
            + "    \"hcpcModifier4\": \"t\",\n"
            + "    \"hcpcModifier5\": \"p\",\n"
            + "    \"acoRedRarc\": \"vp3\",\n"
            + "    \"acoRedCarc\": \"hb\",\n"
            + "    \"acoRedCagc\": \"pt\"\n"
            + "  }, {\n"
            + "    \"rdaPosition\": 3,\n"
            + "    \"nonBillRevCodeEnum\": \"NON_BILL_R\",\n"
            + "    \"revCd\": \"b6g\",\n"
            + "    \"revUnitsBilled\": 21,\n"
            + "    \"revServUnitCnt\": 8,\n"
            + "    \"servDtCymd\": \"2021-03-09\",\n"
            + "    \"servDtCymdText\": \"2021-03-09\",\n"
            + "    \"hcpcCd\": \"96\",\n"
            + "    \"hcpcInd\": \"s\",\n"
            + "    \"hcpcModifier\": \"9\",\n"
            + "    \"hcpcModifier2\": \"s\",\n"
            + "    \"hcpcModifier3\": \"r\",\n"
            + "    \"hcpcModifier4\": \"b\",\n"
            + "    \"hcpcModifier5\": \"2\",\n"
            + "    \"acoRedRarc\": \"knp\",\n"
            + "    \"acoRedCarc\": \"x0j\",\n"
            + "    \"acoRedCagc\": \"6d\"\n"
            + "  }, {\n"
            + "    \"rdaPosition\": 4,\n"
            + "    \"nonBillRevCodeEnum\": \"NON_BILL_S\",\n"
            + "    \"revCd\": \"8\",\n"
            + "    \"revUnitsBilled\": 11,\n"
            + "    \"revServUnitCnt\": 32,\n"
            + "    \"servDtCymd\": \"2021-01-10\",\n"
            + "    \"servDtCymdText\": \"2021-01-10\",\n"
            + "    \"hcpcCd\": \"4jh\",\n"
            + "    \"hcpcInd\": \"5\",\n"
            + "    \"hcpcModifier\": \"r3\",\n"
            + "    \"hcpcModifier2\": \"sn\",\n"
            + "    \"hcpcModifier3\": \"nw\",\n"
            + "    \"hcpcModifier4\": \"b6\",\n"
            + "    \"hcpcModifier5\": \"76\",\n"
            + "    \"acoRedRarc\": \"g3f\",\n"
            + "    \"acoRedCarc\": \"43\",\n"
            + "    \"acoRedCagc\": \"hx\"\n"
            + "  }],\n"
            + "  \"drgCd\": \"t\",\n"
            + "  \"groupCode\": \"n\",\n"
            + "  \"clmTypIndUnrecognized\": \"w\",\n"
            + "  \"recdDtCymdText\": \"2021-02-07\",\n"
            + "  \"currTranDtCymdText\": \"2021-01-20\",\n"
            + "  \"rdaClaimKey\": \"19669840573147667643640083677381\",\n"
            + "  \"intermediaryNb\": \"09142\"\n"
            + "}",
        json);
  }

  /** Verifies that the overrides in the {@link RandomClaimGeneratorConfig} are enforced. */
  @Test
  public void testFieldOverrides() {
    final int maxClaimIds = 18;
    final int maxMbis = 14;
    final var normalConfig = RandomClaimGeneratorConfig.builder().seed(1).build();
    final var normalGenerator = new RandomFissClaimGenerator(normalConfig);
    final var normalClaims =
        IntStream.range(1, 100)
            .mapToObj(i -> normalGenerator.randomClaim())
            .collect(Collectors.toList());

    // We expect to normally get many more unique values than the overrides will use.
    assertThat(
        countDistinctFieldValues(normalClaims, FissClaim::getRdaClaimKey),
        Matchers.greaterThan((long) maxClaimIds));
    assertThat(
        countDistinctFieldValues(normalClaims, FissClaim::getMbi),
        Matchers.greaterThan((long) maxMbis));

    // We expect these ids to normally fall within their normal field length.
    assertThat(
        maxFieldLength(normalClaims, FissClaim::getDcn),
        Matchers.lessThan(RandomMcsClaimGenerator.ForcedErrorFieldLength));
    assertThat(
        maxFieldLength(normalClaims, FissClaim::getIntermediaryNb),
        Matchers.lessThan(RandomMcsClaimGenerator.ForcedErrorFieldLength));

    final var overrideConfig =
        normalConfig
            .toBuilder()
            .maxUniqueClaimIds(maxClaimIds)
            .maxUniqueMbis(maxMbis)
            .randomErrorRate(10)
            .randomErrorSeed(1)
            .build();
    final var overrideGenerator = new RandomFissClaimGenerator(overrideConfig);
    final var overrideClaims =
        IntStream.range(1, 100)
            .mapToObj(i -> overrideGenerator.randomClaim())
            .collect(Collectors.toList());

    // We expect to get exactly the specified number of unique ids.
    assertEquals(maxClaimIds, countDistinctFieldValues(overrideClaims, FissClaim::getRdaClaimKey));
    assertEquals(maxMbis, countDistinctFieldValues(overrideClaims, FissClaim::getMbi));

    // We expect these ids to sometimes have a value with the forced error length when we are
    // forcing errors.
    assertEquals(
        RandomMcsClaimGenerator.ForcedErrorFieldLength,
        maxFieldLength(overrideClaims, FissClaim::getDcn));
    assertEquals(
        RandomMcsClaimGenerator.ForcedErrorFieldLength,
        maxFieldLength(overrideClaims, FissClaim::getIntermediaryNb));
  }
}
