<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1083px" preserveAspectRatio="none" style="width:768px;height:1083px;background:#FFFFFF;" version="1.1" viewBox="0 0 768 1083" width="768px" zoomAndPan="magnify"><defs/><g><!--MD5=[c2dc1ddc239802de9bd2388d9adbf8a8]
cluster Glue Catalog--><g id="cluster_Glue Catalog"><path d="M6,462 C6,452 205,452 205,452 C205,452 404,452 404,462 L404,825 C404,835 205,835 205,835 C205,835 6,835 6,825 L6,462 " style="stroke:#181818;stroke-width:1.0;fill:none;"/><path d="M6,462 C6,472 205,472 205,472 C205,472 404,472 404,462 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="104" x="153" y="486.9951">Glue Catalog</text></g><!--MD5=[227da6eda29c9985c7a36fc9f1032b07]
cluster Cloud Watch--><g id="cluster_Cloud Watch"><path d="M39.5,6 L142.5,6 A3.75,3.75 0 0 1 145,8.5 L152,28.2969 L225.5,28.2969 A2.5,2.5 0 0 1 228,30.7969 L228,265.5 A2.5,2.5 0 0 1 225.5,268 L39.5,268 A2.5,2.5 0 0 1 37,265.5 L37,8.5 A2.5,2.5 0 0 1 39.5,6 " style="stroke:#000000;stroke-width:1.5;fill:none;"/><line style="stroke:#000000;stroke-width:1.5;fill:none;" x1="37" x2="152" y1="28.2969" y2="28.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="102" x="41" y="20.9951">Cloud Watch</text></g><!--MD5=[597f9708cc769570a190f2fde345cab4]
cluster Kinesis FIrehose--><g id="cluster_Kinesis FIrehose"><path d="M94.5,328 L225.5,328 A3.75,3.75 0 0 1 228,330.5 L235,350.2969 L235.5,350.2969 A2.5,2.5 0 0 1 238,352.7969 L238,405.5 A2.5,2.5 0 0 1 235.5,408 L94.5,408 A2.5,2.5 0 0 1 92,405.5 L92,330.5 A2.5,2.5 0 0 1 94.5,328 " style="stroke:#000000;stroke-width:1.5;fill:none;"/><line style="stroke:#000000;stroke-width:1.5;fill:none;" x1="92" x2="235" y1="350.2969" y2="350.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="130" x="96" y="342.9951">Kinesis FIrehose</text></g><!--MD5=[0f1402dd4ba50f92b20010225714ea74]
cluster Analysis--><g id="cluster_Analysis"><path d="M226.5,868 L295.5,868 A3.75,3.75 0 0 1 298,870.5 L305,890.2969 L379.5,890.2969 A2.5,2.5 0 0 1 382,892.7969 L382,1074 A2.5,2.5 0 0 1 379.5,1076.5 L226.5,1076.5 A2.5,2.5 0 0 1 224,1074 L224,870.5 A2.5,2.5 0 0 1 226.5,868 " style="stroke:#000000;stroke-width:1.5;fill:none;"/><line style="stroke:#000000;stroke-width:1.5;fill:none;" x1="224" x2="305" y1="890.2969" y2="890.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="68" x="228" y="882.9951">Analysis</text></g><!--MD5=[1f9199ffb6a15c85b735bf0447fd8d88]
entity api_history--><g id="elem_api_history"><rect fill="#F1F1F1" height="46.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="119" x="22.5" y="502"/><path d="M62.1667,502 L62.1667,507 L55.1667,514 L22.5,514 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="37.5" y="534.9951">api_history</text></g><!--MD5=[0c0421921575f52d5e605439b27fa137]
entity api_requests--><g id="elem_api_requests"><rect fill="#F1F1F1" height="46.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="131" x="256.5" y="502"/><path d="M300.1667,502 L300.1667,507 L293.1667,514 L256.5,514 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="91" x="271.5" y="534.9951">api_requests</text></g><!--MD5=[f9f01024fe1202179498f460cb527c70]
entity benes--><g id="elem_benes"><rect fill="#F1F1F1" height="46.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="84" x="277" y="637.5"/><path d="M305,637.5 L305,642.5 L298,649.5 L277,649.5 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="44" x="292" y="670.4951">benes</text></g><!--MD5=[43fbdc16647b34eaa5ad2af6239e0b0a]
entity benes_unique--><g id="elem_benes_unique"><rect fill="#F1F1F1" height="46.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="138" x="198" y="773"/><path d="M244,773 L244,778 L237,785 L198,785 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="98" x="213" y="805.9951">benes_unique</text></g><!--MD5=[1200cabd2a84086424de0b397dfd2f71]
entity L--><g id="elem_L"><rect fill="#F1F1F1" height="62.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="135" x="64.5" y="41"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="179.5" y="46"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="177.5" y="48"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="177.5" y="52"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="74" x="83.5" y="73.9951">Log Group</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="91" x="79.5" y="90.292">(access.json)</text></g><!--MD5=[4f8ceaf617da225fb01a8e9682419e55]
entity Export--><g id="elem_Export"><ellipse cx="62" cy="223" fill="#F1F1F1" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="49" x="37.5" y="252.9951">Export</text></g><!--MD5=[4a52932e87c05afea63f6d60a0835fd7]
entity Subscription--><g id="elem_Subscription"><ellipse cx="159" cy="223" fill="#F1F1F1" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="91" x="113.5" y="252.9951">Subscription</text></g><g id="elem_Lambda"><ellipse cx="164.1007" cy="377.715" fill="#F1F1F1" rx="52.6007" ry="14.715" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="132.6007" y="381.4626">Lambda</text></g><!--MD5=[770389ab9df153645bc6ef28055eb2b5]
entity A--><g id="elem_A"><rect fill="#F1F1F1" height="46.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="100" x="260" y="903"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="340" y="908"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="338" y="910"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="338" y="914"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="52" x="279" y="935.9951">Athena</text></g><!--MD5=[00ec4551a9636032c33b95aee0b982ec]
entity  QuickSight --><g id="elem_ QuickSight "><rect fill="#F1F1F1" height="46.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="126" x="240" y="1014.5"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="346" y="1019.5"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="344" y="1021.5"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="344" y="1025.5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="78" x="259" y="1047.4951">QuickSight</text></g><g id="elem_GMN2641175"><path d="M422.5,512.5 L422.5,537.6328 L721.5,537.6328 L721.5,522.5 L711.5,512.5 L422.5,512.5 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M711.5,512.5 L711.5,522.5 L721.5,522.5 L711.5,512.5 " fill="#FEFFDD" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="278" x="428.5" y="529.5669">unified historical and incoming raw api data</text></g><g id="elem_GMN2641178"><path d="M420,625 L420,695.5313 L754,695.5313 L754,635 L744,625 L420,625 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M744,625 L744,635 L754,635 L744,625 " fill="#FEFFDD" style="stroke:#181818;stroke-width:1.0;"/><ellipse cx="431.5" cy="637.6328" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118" x="439" y="642.0669">filter out non-200s</text><ellipse cx="431.5" cy="652.7656" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143" x="439" y="657.1997">reduce field selections</text><ellipse cx="431.5" cy="667.8984" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="300" x="439" y="672.3325">pivot out bene_id arrays (one bene per record)</text><ellipse cx="431.5" cy="683.0313" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="269" x="439" y="687.4653">stored in Parquet format (columnar store)</text></g><g id="elem_GMN2641181"><path d="M442.5,776 L442.5,816.2656 L761.5,816.2656 L761.5,786 L751.5,776 L442.5,776 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M751.5,776 L751.5,786 L761.5,786 L751.5,776 " fill="#FEFFDD" style="stroke:#181818;stroke-width:1.0;"/><ellipse cx="454" cy="788.6328" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143" x="461.5" y="793.0669">reduce field selections</text><ellipse cx="454" cy="803.7656" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="285" x="461.5" y="808.1997">only stores the "first seen" record for a bene</text></g><g id="elem_GMN2641191"><path d="M247,165 L247,280.9297 L569,280.9297 L569,175 L559,165 L247,165 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M559,165 L559,175 L569,175 L559,165 " fill="#FEFFDD" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="290" x="253" y="182.0669">CW Exports have a very inconvenient format</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="274" x="253" y="197.1997">that do not match the subscription format.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="271" x="253" y="212.3325">Furthermore they cannot be exported into</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="292" x="253" y="227.4653">S3 buckets that use KMS, so we have to have</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="301" x="253" y="242.5981">a separate process to ingest them. This should</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="296" x="253" y="257.731">be an infrequent operation to initially populate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94" x="253" y="272.8638">historical data.</text></g><g id="elem_GMN2641198"><path d="M254.5,350 L254.5,373.5 L216.834,377.5 L254.5,381.5 L254.5,405.3984 A0,0 0 0 0 254.5,405.3984 L499.5,405.3984 A0,0 0 0 0 499.5,405.3984 L499.5,360 L489.5,350 L254.5,350 A0,0 0 0 0 254.5,350 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M489.5,350 L489.5,360 L499.5,360 L489.5,350 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="208" x="260.5" y="367.0669">Flatten the JSON schema so that</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="224" x="260.5" y="382.1997">we have one column for each MDC</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="93" x="260.5" y="397.3325">structure field.</text></g><g id="elem_GMN2641210"><path d="M398.5,898.5 L398.5,922 L360.1,926 L398.5,930 L398.5,953.8984 A0,0 0 0 0 398.5,953.8984 L675.5,953.8984 A0,0 0 0 0 675.5,953.8984 L675.5,908.5 L665.5,898.5 L398.5,898.5 A0,0 0 0 0 398.5,898.5 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M665.5,898.5 L665.5,908.5 L675.5,908.5 L665.5,898.5 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="243" x="404.5" y="915.5669">dahboards can be built on either table</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="256" x="404.5" y="930.6997">for the use case but queries against the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="225" x="404.5" y="945.8325">benes table may become unwieldy</text></g><!--MD5=[d54d530774c9e4a52739cebb314243ea]
link api_requests to GMN2641175--><g id="link_api_requests_GMN2641175"><path d="M387.918,525 C399.423,525 410.928,525 422.433,525 " fill="none" id="api_requests-GMN2641175" style="stroke:#181818;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/></g><!--MD5=[1fd3f93fd4e3a0aaacff4175a3f2efab]
link benes to GMN2641178--><g id="link_benes_GMN2641178"><path d="M361.137,660.5 C380.694,660.5 400.251,660.5 419.808,660.5 " fill="none" id="benes-GMN2641178" style="stroke:#181818;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/></g><!--MD5=[88d5023c11bbc5c5b3f02ff72e5235ed]
link benes_unique to GMN2641181--><g id="link_benes_unique_GMN2641181"><path d="M336.028,796 C371.439,796 406.85,796 442.261,796 " fill="none" id="benes_unique-GMN2641181" style="stroke:#181818;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/></g><!--MD5=[13d3850150c6d7eb9c77f8bedc1ebe53]
link L to Export--><g id="link_L_Export"><path d="M116.976,104.344 C108.399,122.051 97.496,144.728 88,165 C80.8944,180.168 72.9289,197.714 67.7095,209.288 " fill="none" id="L-to-Export" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="65.6512,213.858,72.9937,207.2939,67.7041,209.2989,65.6991,204.0093,65.6512,213.858" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[854e1f18926935238859158b6cd60da2]
link Export to api_history--><g id="link_Export_api_history"><path d="M62.535,232.024 C65.0545,269.818 75.7975,430.963 80.1539,496.308 " fill="none" id="Export-to-api_history" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="80.5058,501.587,83.8978,492.3407,80.1729,496.5981,75.9155,492.8732,80.5058,501.587" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[7d62cf6410dc5ab0b027549eac00cede]
link L to Subscription--><g id="link_L_Subscription"><path d="M137.594,104.269 C143.457,136.515 152.392,185.655 156.621,208.917 " fill="none" id="L-to-Subscription" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="157.544,213.991,159.8695,204.4206,156.6496,209.0717,151.9986,205.8517,157.544,213.991" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[9ea23e4bbd3892a2347c228f2c95cd5a]
link GMN2641191 to Export--><g id="link_GMN2641191_Export"><path d="M300.325,164.966 C271.91,152.407 240.721,140.961 210.5,134.5 C164.865,124.743 145.883,111.112 105.5,134.5 C76.3143,151.403 66.2875,194.699 63.2159,213.758 " fill="none" id="GMN2641191-Export" style="stroke:#181818;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/></g><!--MD5=[81a849ca3791a4a54d46d7afc6f4aea5]
link Subscription to Lambda--><g id="link_Subscription_Lambda"><path d="M159.269,232.199 C160.043,255.807 162.291,324.377 163.386,357.778 " fill="none" id="Subscription-to-Lambda" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="163.552,362.824,167.2541,353.6974,163.3877,357.8267,159.2584,353.9603,163.552,362.824" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[2ca5027db3126758bf537c4696d9cf76]
link Lambda to api_history--><g id="link_Lambda_api_history"><path d="M156.433,391.927 C142.942,415.866 114.508,466.318 96.951,497.471 " fill="none" id="Lambda-to-api_history" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="94.443,501.921,102.3474,496.0456,96.8986,497.5655,95.3787,492.1167,94.443,501.921" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[1f08c5f95f32c0ec27f6efdca93208fe]
link api_history to api_requests--><g id="link_api_history_api_requests"><path d="M141.634,525 C174.846,525 216.4,525 251.249,525 " fill="none" id="api_history-to-api_requests" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="256.34,525,247.34,521,251.34,525,247.34,529,256.34,525" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="160" y="518.0669">Glue:Flatten</text></g><!--MD5=[7604c24c973536cf7c437776e851313f]
link api_requests to benes--><g id="link_api_requests_benes"><path d="M321.505,548.045 C320.986,571.138 320.17,607.442 319.611,632.301 " fill="none" id="api_requests-to-benes" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="319.496,637.422,323.6981,628.5146,319.6089,632.4233,315.7002,628.334,319.496,637.422" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="90" x="321" y="591.0669">Glue:Populate</text></g><!--MD5=[4def35a06e9c6394278dbe053da46f8a]
link benes to benes_unique--><g id="link_benes_benes_unique"><path d="M290.566,687.643 C280.82,698.452 271.092,711.782 266,726 C261.257,739.243 261.075,754.853 262.268,767.873 " fill="none" id="benes-benes_unique" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="262.808,772.909,265.8234,763.5331,262.2737,767.9376,257.8692,764.388,262.808,772.909" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="294.149,683.777,285.0975,687.6591,290.7503,687.4443,290.9652,693.097,294.149,683.777" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="95" x="267" y="739.0669">Glue: Combine</text></g><!--MD5=[c58130d1eb586e0c9e061c6597e577f0]
link A to  QuickSight --><g id="link_A_ QuickSight "><path d="M308.583,949.159 C307.473,966.524 305.924,990.767 304.738,1009.3065 " fill="none" id="A-to- QuickSight " style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="304.414,1014.374,308.9803,1005.6477,304.7331,1009.3842,300.9966,1005.137,304.414,1014.374" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[ea7cd6f22882a65ab72c62460cb5d1b1]
link benes to A--><g id="link_benes_A"><path d="M341.039,683.598 C351.038,695.186 361.777,710.232 367,726 C387.199,786.975 351.408,859.811 327.963,898.223 " fill="none" id="benes-to-A" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="325.169,902.733,333.3082,897.1874,327.8015,898.4821,326.5068,892.9754,325.169,902.733" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[045754c7f025b8276b8fd4c17f85c55c]
link benes_unique to A--><g id="link_benes_unique_A"><path d="M274.392,819.004 C281.745,840.892 293.04,874.514 300.931,898.004 " fill="none" id="benes_unique-to-A" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="302.561,902.855,303.4884,893.0499,300.9696,898.115,295.9045,895.5962,302.561,902.855" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[d1506f0829adc3dc4b981d467c2ec97e]
@startuml
database "Glue Catalog" {
  frame "api_history" as api_history {
  }
  frame "api_requests" as api_requests {
  }
  frame "benes" as benes {
  }
  frame "benes_unique" as benes_unique {
  }
}

note right of api_requests
  unified historical and incoming raw api data
end note

note right of benes
  * filter out non-200s
  * reduce field selections
  * pivot out bene_id arrays (one bene per record)
  * stored in Parquet format (columnar store)
end note

note right of benes_unique
  * reduce field selections
  * only stores the "first seen" record for a bene
end note

package "Cloud Watch" {
  [ Log Group\n(access.json) ] as L
  L - -> () Export
  Export - -> api_history
  L - -> () Subscription
}

note left of Export
   CW Exports have a very inconvenient format
   that do not match the subscription format.
   Furthermore they cannot be exported into
   S3 buckets that use KMS, so we have to have
   a separate process to ingest them. This should
   be an infrequent operation to initially populate
   historical data.
end note

package "Kinesis FIrehose" {
(Lambda)
}

Subscription - -> (Lambda)
Lambda - -> api_history

note right of Lambda
  Flatten the JSON schema so that
  we have one column for each MDC
  structure field.
end note

api_history -> api_requests : Glue:Flatten

api_requests - -> benes : Glue:Populate
benes <- -> benes_unique : Glue: Combine

package "Analysis" {
  [ Athena ] as A
  A - -> [ QuickSight ]
  benes - -> A
  benes_unique - -> A
}

note right of A
  dahboards can be built on either table
  for the use case but queries against the
  benes table may become unwieldy
end note
@enduml

PlantUML version 1.2022.7beta2(Unknown compile time)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>