<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1083px" preserveAspectRatio="none" style="width:634px;height:1083px;background:#FFFFFF;" version="1.1" viewBox="0 0 634 1083" width="634px" zoomAndPan="magnify"><defs/><g><!--MD5=[c2dc1ddc239802de9bd2388d9adbf8a8]
cluster Glue Catalog--><g id="cluster_Glue Catalog"><path d="M48,462 C48,452 133,452 133,452 C133,452 218,452 218,462 L218,825 C218,835 133,835 133,835 C133,835 48,835 48,825 L48,462 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><path d="M48,462 C48,472 133,472 133,472 C133,472 218,472 218,462 " fill="none" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="104" x="81" y="486.9951">Glue Catalog</text></g><!--MD5=[227da6eda29c9985c7a36fc9f1032b07]
cluster Cloud Watch--><g id="cluster_Cloud Watch"><path d="M89.5,6 L192.5,6 A3.75,3.75 0 0 1 195,8.5 L202,28.2969 L275.5,28.2969 A2.5,2.5 0 0 1 278,30.7969 L278,265.5 A2.5,2.5 0 0 1 275.5,268 L89.5,268 A2.5,2.5 0 0 1 87,265.5 L87,8.5 A2.5,2.5 0 0 1 89.5,6 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="87" x2="202" y1="28.2969" y2="28.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="102" x="91" y="20.9951">Cloud Watch</text></g><!--MD5=[d2214bb73b5efd5a5666db485b6a9701]
cluster Athena--><g id="cluster_Athena"><path d="M8.5,328 L67.5,328 A3.75,3.75 0 0 1 70,330.5 L77,350.2969 L137.5,350.2969 A2.5,2.5 0 0 1 140,352.7969 L140,405.5 A2.5,2.5 0 0 1 137.5,408 L8.5,408 A2.5,2.5 0 0 1 6,405.5 L6,330.5 A2.5,2.5 0 0 1 8.5,328 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="6" x2="77" y1="350.2969" y2="350.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="58" x="10" y="342.9951">Athena</text></g><!--MD5=[d7bf45cf252ddd919235dd930d9f22c8]
cluster Kinesis Firehose--><g id="cluster_Kinesis Firehose"><path d="M166.5,328 L297.5,328 A3.75,3.75 0 0 1 300,330.5 L307,350.2969 L307.5,350.2969 A2.5,2.5 0 0 1 310,352.7969 L310,405.5 A2.5,2.5 0 0 1 307.5,408 L166.5,408 A2.5,2.5 0 0 1 164,405.5 L164,330.5 A2.5,2.5 0 0 1 166.5,328 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="164" x2="307" y1="350.2969" y2="350.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="130" x="168" y="342.9951">Kinesis Firehose</text></g><!--MD5=[0f1402dd4ba50f92b20010225714ea74]
cluster Analysis--><g id="cluster_Analysis"><path d="M122.5,868 L191.5,868 A3.75,3.75 0 0 1 194,870.5 L201,890.2969 L275.5,890.2969 A2.5,2.5 0 0 1 278,892.7969 L278,1074 A2.5,2.5 0 0 1 275.5,1076.5 L122.5,1076.5 A2.5,2.5 0 0 1 120,1074 L120,870.5 A2.5,2.5 0 0 1 122.5,868 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="120" x2="201" y1="890.2969" y2="890.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="68" x="124" y="882.9951">Analysis</text></g><!--MD5=[0c0421921575f52d5e605439b27fa137]
entity api_requests--><g id="elem_api_requests"><rect fill="#F1F1F1" height="46.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="131" x="66.5" y="502"/><path d="M110.1667,502 L110.1667,507 L103.1667,514 L66.5,514 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="91" x="81.5" y="534.9951">api_requests</text></g><!--MD5=[f9f01024fe1202179498f460cb527c70]
entity benes--><g id="elem_benes"><rect fill="#F1F1F1" height="46.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="84" x="91" y="637.5"/><path d="M119,637.5 L119,642.5 L112,649.5 L91,649.5 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="44" x="106" y="670.4951">benes</text></g><!--MD5=[43fbdc16647b34eaa5ad2af6239e0b0a]
entity benes_unique--><g id="elem_benes_unique"><rect fill="#F1F1F1" height="46.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="138" x="64" y="773"/><path d="M110,773 L110,778 L103,785 L64,785 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="98" x="79" y="805.9951">benes_unique</text></g><!--MD5=[1200cabd2a84086424de0b397dfd2f71]
entity L--><g id="elem_L"><rect fill="#F1F1F1" height="62.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="135" x="114.5" y="41"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="229.5" y="46"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="227.5" y="48"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="227.5" y="52"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="74" x="133.5" y="73.9951">Log Group</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="91" x="129.5" y="90.292">(access.json)</text></g><!--MD5=[4f8ceaf617da225fb01a8e9682419e55]
entity Export--><g id="elem_Export"><ellipse cx="112" cy="223" fill="#F1F1F1" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="49" x="87.5" y="252.9951">Export</text></g><!--MD5=[4a52932e87c05afea63f6d60a0835fd7]
entity Subscription--><g id="elem_Subscription"><ellipse cx="209" cy="223" fill="#F1F1F1" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="91" x="163.5" y="252.9951">Subscription</text></g><g id="elem_Queries"><ellipse cx="72.8615" cy="377.6946" fill="#F1F1F1" rx="50.3615" ry="14.6946" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="54" x="42.8615" y="381.4422">Queries</text></g><g id="elem_Lambda"><ellipse cx="233.1007" cy="377.715" fill="#F1F1F1" rx="52.6007" ry="14.715" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="201.6007" y="381.4626">Lambda</text></g><!--MD5=[770389ab9df153645bc6ef28055eb2b5]
entity A--><g id="elem_A"><rect fill="#F1F1F1" height="46.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="100" x="156" y="903"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="236" y="908"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="234" y="910"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="234" y="914"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="52" x="175" y="935.9951">Athena</text></g><!--MD5=[00ec4551a9636032c33b95aee0b982ec]
entity  QuickSight --><g id="elem_ QuickSight "><rect fill="#F1F1F1" height="46.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="126" x="136" y="1014.5"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="242" y="1019.5"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="240" y="1021.5"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="240" y="1025.5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="78" x="155" y="1047.4951">QuickSight</text></g><g id="elem_GMN414503"><path d="M234.5,512.5 L234.5,537.6328 L533.5,537.6328 L533.5,522.5 L523.5,512.5 L234.5,512.5 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M523.5,512.5 L523.5,522.5 L533.5,522.5 L523.5,512.5 " fill="#FEFFDD" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="278" x="240.5" y="529.5669">unified historical and incoming raw api data</text></g><g id="elem_GMN414506"><path d="M234,625 L234,695.5313 L568,695.5313 L568,635 L558,625 L234,625 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M558,625 L558,635 L568,635 L558,625 " fill="#FEFFDD" style="stroke:#181818;stroke-width:1.0;"/><ellipse cx="245.5" cy="637.6328" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118" x="253" y="642.0669">filter out non-200s</text><ellipse cx="245.5" cy="652.7656" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143" x="253" y="657.1997">reduce field selections</text><ellipse cx="245.5" cy="667.8984" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="300" x="253" y="672.3325">pivot out bene_id arrays (one bene per record)</text><ellipse cx="245.5" cy="683.0313" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="269" x="253" y="687.4653">stored in Parquet format (columnar store)</text></g><g id="elem_GMN414509"><path d="M308.5,776 L308.5,816.2656 L627.5,816.2656 L627.5,786 L617.5,776 L308.5,776 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M617.5,776 L617.5,786 L627.5,786 L617.5,776 " fill="#FEFFDD" style="stroke:#181818;stroke-width:1.0;"/><ellipse cx="320" cy="788.6328" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143" x="327.5" y="793.0669">reduce field selections</text><ellipse cx="320" cy="803.7656" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="285" x="327.5" y="808.1997">only stores the "first seen" record for a bene</text></g><g id="elem_GMN414518"><path d="M297,165 L297,280.9297 L619,280.9297 L619,175 L609,165 L297,165 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M609,165 L609,175 L619,175 L609,165 " fill="#FEFFDD" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="290" x="303" y="182.0669">CW Exports have a very inconvenient format</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="274" x="303" y="197.1997">that do not match the subscription format.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="271" x="303" y="212.3325">Furthermore they cannot be exported into</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="292" x="303" y="227.4653">S3 buckets that use KMS, so we have to have</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="301" x="303" y="242.5981">a separate process to ingest them. This should</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="296" x="303" y="257.731">be an infrequent operation to initially populate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94" x="303" y="272.8638">historical data.</text></g><g id="elem_GMN414529"><path d="M326.5,350 L326.5,373.5 L285.734,377.5 L326.5,381.5 L326.5,405.3984 A0,0 0 0 0 326.5,405.3984 L571.5,405.3984 A0,0 0 0 0 571.5,405.3984 L571.5,360 L561.5,350 L326.5,350 A0,0 0 0 0 326.5,350 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M561.5,350 L561.5,360 L571.5,360 L561.5,350 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="208" x="332.5" y="367.0669">Flatten the JSON schema so that</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="224" x="332.5" y="382.1997">we have one column for each MDC</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="93" x="332.5" y="397.3325">structure field.</text></g><g id="elem_GMN414540"><path d="M294.5,898.5 L294.5,922 L256.1,926 L294.5,930 L294.5,953.8984 A0,0 0 0 0 294.5,953.8984 L571.5,953.8984 A0,0 0 0 0 571.5,953.8984 L571.5,908.5 L561.5,898.5 L294.5,898.5 A0,0 0 0 0 294.5,898.5 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M561.5,898.5 L561.5,908.5 L571.5,908.5 L561.5,898.5 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="243" x="300.5" y="915.5669">dahboards can be built on either table</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="256" x="300.5" y="930.6997">for the use case but queries against the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="225" x="300.5" y="945.8325">benes table may become unwieldy</text></g><!--MD5=[ec5a1fa32aa59df2658168cb1bda55ad]
link api_requests to GMN414503--><g id="link_api_requests_GMN414503"><path d="M197.953,525 C210.066,525 222.178,525 234.29,525 " fill="none" id="api_requests-GMN414503" style="stroke:#181818;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/></g><!--MD5=[7501181a3c881a71f57c176ec8234545]
link benes to GMN414506--><g id="link_benes_GMN414506"><path d="M175.137,660.5 C194.694,660.5 214.251,660.5 233.808,660.5 " fill="none" id="benes-GMN414506" style="stroke:#181818;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/></g><!--MD5=[1b08102a7149e65df13811a7e5ed66b1]
link benes_unique to GMN414509--><g id="link_benes_unique_GMN414509"><path d="M202.028,796 C237.439,796 272.85,796 308.261,796 " fill="none" id="benes_unique-GMN414509" style="stroke:#181818;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/></g><!--MD5=[13d3850150c6d7eb9c77f8bedc1ebe53]
link L to Export--><g id="link_L_Export"><path d="M166.976,104.344 C158.399,122.051 147.496,144.728 138,165 C130.894,180.168 122.929,197.714 117.709,209.288 " fill="none" id="L-to-Export" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="115.651,213.858,122.9938,207.2942,117.7041,209.299,115.6993,204.0093,115.651,213.858" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[7d62cf6410dc5ab0b027549eac00cede]
link L to Subscription--><g id="link_L_Subscription"><path d="M187.594,104.269 C193.457,136.515 202.392,185.655 206.621,208.917 " fill="none" id="L-to-Subscription" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="207.544,213.991,209.8695,204.4206,206.6496,209.0717,201.9986,205.8517,207.544,213.991" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[5b0c9bfcdebb9dced4830073f6d1725a]
link GMN414518 to Export--><g id="link_GMN414518_Export"><path d="M350.325,164.966 C321.91,152.407 290.721,140.961 260.5,134.5 C214.865,124.743 195.883,111.112 155.5,134.5 C126.314,151.403 116.287,194.699 113.216,213.758 " fill="none" id="GMN414518-Export" style="stroke:#181818;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/></g><!--MD5=[3f04481cee619b48fad5b93ed0c9b42e]
link Export to Queries--><g id="link_Export_Queries"><path d="M109.903,232.199 C103.866,255.807 86.3297,324.377 77.788,357.778 " fill="none" id="Export-to-Queries" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="76.4975,362.824,82.6044,355.0971,77.7374,357.9802,74.8543,353.1132,76.4975,362.824" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[d4c7cd46bcfa186dd09f43f95c675771]
link Queries to api_requests--><g id="link_Queries_api_requests"><path d="M78.4448,391.927 C88.1119,415.767 108.443,465.905 121.087,497.087 " fill="none" id="Queries-to-api_requests" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="123.047,501.921,123.3704,492.0775,121.1674,497.2877,115.9571,495.0848,123.047,501.921" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[81a849ca3791a4a54d46d7afc6f4aea5]
link Subscription to Lambda--><g id="link_Subscription_Lambda"><path d="M210.29,232.199 C214.006,255.807 224.797,324.377 230.054,357.778 " fill="none" id="Subscription-to-Lambda" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="230.848,362.824,233.4003,353.3116,230.0708,357.8848,225.4976,354.5552,230.848,362.824" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[0eacc5fe3bd22f785a86d33c91773850]
link Lambda to api_requests--><g id="link_Lambda_api_requests"><path d="M223.679,391.927 C207.062,415.866 172.04,466.318 150.416,497.471 " fill="none" id="Lambda-to-api_requests" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="147.326,501.921,155.7444,496.8092,150.1775,497.8138,149.1729,492.2469,147.326,501.921" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[7604c24c973536cf7c437776e851313f]
link api_requests to benes--><g id="link_api_requests_benes"><path d="M132.165,548.045 C132.338,571.138 132.61,607.442 132.796,632.301 " fill="none" id="api_requests-to-benes" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="132.835,637.422,136.7655,628.3914,132.7964,632.4221,128.7657,628.4531,132.835,637.422" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="90" x="134" y="591.0669">Glue:Populate</text></g><!--MD5=[4def35a06e9c6394278dbe053da46f8a]
link benes to benes_unique--><g id="link_benes_benes_unique"><path d="M132.366,688.823 C132.074,704.648 131.826,724.948 132,743 C132.077,750.996 132.22,759.683 132.375,767.626 " fill="none" id="benes-benes_unique" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="132.483,772.989,136.2996,763.9097,132.3816,767.99,128.3013,764.072,132.483,772.989" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="132.467,683.638,128.2929,692.5586,132.3699,688.6371,136.2914,692.714,132.467,683.638" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="95" x="133" y="739.0669">Glue: Combine</text></g><!--MD5=[c58130d1eb586e0c9e061c6597e577f0]
link A to  QuickSight --><g id="link_A_ QuickSight "><path d="M204.583,949.159 C203.473,966.524 201.924,990.767 200.738,1009.3065 " fill="none" id="A-to- QuickSight " style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="200.414,1014.374,204.9803,1005.6477,200.7331,1009.3842,196.9966,1005.137,200.414,1014.374" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[ea7cd6f22882a65ab72c62460cb5d1b1]
link benes to A--><g id="link_benes_A"><path d="M175.05,677.071 C196.511,687.415 220.643,703.325 233,726 C263.22,781.454 237.158,858.062 219.33,898.126 " fill="none" id="benes-to-A" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="217.201,902.827,224.5573,896.2783,219.2634,898.2722,217.2696,892.9784,217.201,902.827" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[045754c7f025b8276b8fd4c17f85c55c]
link benes_unique to A--><g id="link_benes_unique_A"><path d="M145.549,819.004 C158.084,840.984 177.368,874.795 190.772,898.298 " fill="none" id="benes_unique-to-A" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="193.37,902.855,192.3854,893.0555,190.8927,898.5119,185.4363,897.0192,193.37,902.855" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[dece2ec6a07aa61cd263c6ada02d0eab]
@startuml
database "Glue Catalog" {
  frame "api_requests" as api_requests {
  }
  frame "benes" as benes {
  }
  frame "benes_unique" as benes_unique {
  }
}

note right of api_requests
  unified historical and incoming raw api data
end note

note right of benes
  * filter out non-200s
  * reduce field selections
  * pivot out bene_id arrays (one bene per record)
  * stored in Parquet format (columnar store)
end note

note right of benes_unique
  * reduce field selections
  * only stores the "first seen" record for a bene
end note

package "Cloud Watch" {
  [ Log Group\n(access.json) ] as L
  L - -> () Export
  L - -> () Subscription
}

note left of Export
   CW Exports have a very inconvenient format
   that do not match the subscription format.
   Furthermore they cannot be exported into
   S3 buckets that use KMS, so we have to have
   a separate process to ingest them. This should
   be an infrequent operation to initially populate
   historical data.
end note

package "Athena" {
  (Queries)
}

package "Kinesis Firehose" {
(Lambda)
}

Export - -> Queries
Queries - -> api_requests

Subscription - -> (Lambda)
Lambda - -> api_requests

note right of Lambda
  Flatten the JSON schema so that
  we have one column for each MDC
  structure field.
end note

api_requests - -> benes : Glue:Populate
benes <- -> benes_unique : Glue: Combine

package "Analysis" {
  [ Athena ] as A
  A - -> [ QuickSight ]
  benes - -> A
  benes_unique - -> A
}

note right of A
  dahboards can be built on either table
  for the use case but queries against the
  benes table may become unwieldy
end note
@enduml

PlantUML version 1.2022.8beta2(Unknown compile time)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>