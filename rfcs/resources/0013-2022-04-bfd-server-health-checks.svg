<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="707px" preserveAspectRatio="none" style="width:858px;height:707px;background:#FFFFFF;" version="1.1" viewBox="0 0 858 707" width="858px" zoomAndPan="magnify"><defs/><g><rect height="26.4883" style="stroke:#00000000;stroke-width:1.0;fill:none;" width="352" x="246.25" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="342" x="251.25" y="23.5352">2022-04 BFD Server Health Checks (simplified)</text><g id="Instantiation"><rect fill="#F1F1F1" height="85.9531" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="204" x="7" y="153.4883"/><line style="stroke:#181818;stroke-width:0.5;" x1="7" x2="211" y1="179.9766" y2="179.9766"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="86" x="66" y="172.0234">Instantiation</text><ellipse cx="17.5" cy="193.9648" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="141" x="24" y="198.5117">EC2 Status Check (-)</text><ellipse cx="17.5" cy="210.4531" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="172" x="24" y="215">CLB TCP Health Check (-)</text><ellipse cx="17.5" cy="226.9414" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="137" x="24" y="231.4883">bfd-server ready (-)</text></g><g id="Configure"><rect fill="#F1F1F1" height="102.4414" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="204" x="380" y="145.4883"/><line style="stroke:#181818;stroke-width:0.5;" x1="380" x2="584" y1="171.9766" y2="171.9766"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="69" x="447.5" y="164.0234">Configure</text><ellipse cx="390.5" cy="185.9648" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="144" x="397" y="190.5117">EC2 Status Check (+)</text><ellipse cx="390.5" cy="202.4531" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="172" x="397" y="207">CLB TCP Health Check (-)</text><ellipse cx="390.5" cy="218.9414" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="152" x="397" y="223.4883">Instance port 7443 (-)</text><ellipse cx="390.5" cy="235.4297" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="137" x="397" y="239.9766">bfd-server ready (-)</text></g><g id="elem_GMN4"><path d="M348,43.4883 L348,68.7988 A0,0 0 0 0 348,68.7988 L478,68.7988 L482,145.3483 L486,68.7988 L616,68.7988 A0,0 0 0 0 616,68.7988 L616,53.4883 L606,43.4883 L348,43.4883 A0,0 0 0 0 348,43.4883 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M606,43.4883 L606,53.4883 L616,53.4883 L606,43.4883 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="247" x="354" y="61.0566">EC2 status checks may still be pending</text></g><g id="Startup"><rect fill="#F1F1F1" height="102.4414" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="207" x="378.5" y="339.4883"/><line style="stroke:#181818;stroke-width:0.5;" x1="378.5" x2="585.5" y1="365.9766" y2="365.9766"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="50" x="457" y="358.0234">Startup</text><ellipse cx="389" cy="379.9648" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="144" x="395.5" y="384.5117">EC2 Status Check (+)</text><ellipse cx="389" cy="396.4531" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="175" x="395.5" y="401">CLB TCP Health Check (+)</text><ellipse cx="389" cy="412.9414" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="155" x="395.5" y="417.4883">Instance port 7443 (+)</text><ellipse cx="389" cy="429.4297" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="137" x="395.5" y="433.9766">bfd-server ready (-)</text></g><g id="elem_GMN8"><path d="M620.5,369.9883 L620.5,386.4883 L585.68,390.4883 L620.5,394.4883 L620.5,410.6094 A0,0 0 0 0 620.5,410.6094 L851.5,410.6094 A0,0 0 0 0 851.5,410.6094 L851.5,379.9883 L841.5,369.9883 L620.5,369.9883 A0,0 0 0 0 620.5,369.9883 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M841.5,369.9883 L841.5,379.9883 L851.5,379.9883 L841.5,369.9883 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="210" x="626.5" y="387.5566">Instance eligible to receive traffic</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97" x="626.5" y="402.8672">!!! Requests fail</text></g><g id="Started"><rect fill="#F1F1F1" height="102.4414" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="207" x="378.5" y="518.4883"/><line style="stroke:#181818;stroke-width:0.5;" x1="378.5" x2="585.5" y1="544.9766" y2="544.9766"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="49" x="457.5" y="537.0234">Started</text><ellipse cx="389" cy="558.9648" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="144" x="395.5" y="563.5117">EC2 Status Check (+)</text><ellipse cx="389" cy="575.4531" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="175" x="395.5" y="580">CLB TCP Health Check (+)</text><ellipse cx="389" cy="591.9414" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="155" x="395.5" y="596.4883">Instance port 7443 (+)</text><ellipse cx="389" cy="608.4297" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="140" x="395.5" y="612.9766">bfd-server ready (+)</text></g><g id="elem_GMN12"><path d="M28.5,541.4883 L28.5,597.4199 A0,0 0 0 0 28.5,597.4199 L343.5,597.4199 A0,0 0 0 0 343.5,597.4199 L343.5,573.4883 L378.42,569.4883 L343.5,565.4883 L343.5,551.4883 L333.5,541.4883 L28.5,541.4883 A0,0 0 0 0 28.5,541.4883 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M333.5,541.4883 L333.5,551.4883 L343.5,551.4883 L333.5,541.4883 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94" x="34.5" y="559.0566">NOT DEPICTED</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="291" x="34.5" y="574.3672">The ASG is configured to terminate bfd-server</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="294" x="34.5" y="589.6777">instances that fail to reach "Started" after 430s</text></g><ellipse cx="109" cy="55.9883" fill="#222222" rx="10" ry="10" style="stroke:none;stroke-width:1.0;"/><ellipse cx="482" cy="691.4883" fill="none" rx="10" ry="10" style="stroke:#222222;stroke-width:1.0;"/><ellipse cx="482.5" cy="691.9883" fill="#222222" rx="6" ry="6" style="stroke:none;stroke-width:1.0;"/><!--MD5=[931cebf400d289cb28c67c889569cef0]
link *start to Instantiation--><g id="link_*start_Instantiation"><path d="M109,66.0783 C109,82.5783 109,118.5083 109,148.3283 " fill="none" id="*start-to-Instantiation" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="109,153.4383,113,144.4383,109,148.4383,105,144.4383,109,153.4383" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="181" x="110" y="112.0566">ASG scaling event; bootstrap</text></g><!--MD5=[effa6542e0ce5032f22f05d73acb46ad]
link Instantiation to Configure--><g id="link_Instantiation_Configure"><path d="M211.42,196.4883 C262.08,196.4883 323.22,196.4883 374.56,196.4883 " fill="none" id="Instantiation-to-Configure" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="379.81,196.4883,370.81,192.4883,374.81,196.4883,370.81,200.4883,379.81,196.4883" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="132" x="229.5" y="190.0566">successful bootstrap</text></g><!--MD5=[020a8f1aba345be4bc262b59c63b5ced]
link Configure to Configure--><g id="link_Configure_Configure"><path d="M584.17,180.6683 C604.5,182.4483 619,187.7183 619,196.4883 C619,204.4983 606.89,209.5983 589.27,211.7683 " fill="none" id="Configure-to-Configure" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="584.17,212.3083,593.5338,215.361,589.1435,211.7938,592.7106,207.4034,584.17,212.3083" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="625" y="201.5566">execute cloud-init</text></g><!--MD5=[f3d5d18e146c9df340baf7fd37833900]
link Configure to Startup--><g id="link_Configure_Startup"><path d="M425.57,247.7783 C418.4,256.9083 412.14,266.9183 408,277.4883 C400.21,297.3983 407.5,317.4183 420.06,334.9083 " fill="none" id="Configure-to-Startup" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="423.37,339.2983,421.17,329.6983,420.37,335.2983,414.77,334.4983,423.37,339.2983" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100" x="409" y="298.5566">bfd-server start</text></g><!--MD5=[ed5f440ccf49d975a63e2f0c1f25df6f]
reverse link Configure to Startup--><g id="link_Configure_Startup"><path d="M507.25,252.8383 C510.04,260.9583 512.43,269.3383 514,277.4883 C517.96,298.0383 513.49,320.2783 506.75,339.4883 " fill="none" id="Configure-backto-Startup" style="stroke:#FF0000;stroke-width:1.0;"/><polygon fill="#FF0000" points="505.47,247.8283,504.7168,257.6483,507.1453,252.5393,512.2544,254.9678,505.47,247.8283" style="stroke:#FF0000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176" x="516" y="291.0566">internal health check failure</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="112" x="548" y="306.3672">bfd-server restart</text></g><!--MD5=[66c9b03d2d18e9f8971a804447331d4b]
link Startup to Started--><g id="link_Startup_Started"><path d="M482,441.7383 C482,464.0683 482,490.4183 482,513.2983 " fill="none" id="Startup-to-Started" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="482,518.4183,486,509.4183,482,513.4183,478,509.4183,482,518.4183" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="186" x="483" y="485.0566">internal health check success</text></g><!--MD5=[be4b1bd390b8ff018cb388c7193b3b7a]
link Started to *end--><g id="link_Started_*end"><path d="M482,620.6883 C482,640.8683 482,662.5783 482,676.3283 " fill="none" id="Started-to-*end" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="482,681.3683,486,672.3683,482,676.3683,478,672.3683,482,681.3683" style="stroke:#181818;stroke-width:1.0;"/></g><!--MD5=[6459144f8c8e36e17cbb86d8ae211013]
@startuml
title 2022-04 BFD Server Health Checks (simplified)

state Instantiation
Instantiation : * EC2 Status Check (-)
Instantiation : * CLB TCP Health Check (-)
Instantiation : * bfd-server ready (-)

note top of Configure
       EC2 status checks may still be pending
end note

state Configure
Configure : * EC2 Status Check (+)
Configure : * CLB TCP Health Check (-)
Configure : * Instance port 7443 (-)
Configure : * bfd-server ready (-)


state Startup
Startup : * EC2 Status Check (+)
Startup : * CLB TCP Health Check (+)
Startup : * Instance port 7443 (+)
Startup : * bfd-server ready (-)

note right of Startup
       Instance eligible to receive traffic
       !!! Requests fail
end note

note left of Started
       NOT DEPICTED
       The ASG is configured to terminate bfd-server
       instances that fail to reach "Started" after 430s
end note

state Started
Started : * EC2 Status Check (+)
Started : * CLB TCP Health Check (+)
Started : * Instance port 7443 (+)
Started : * bfd-server ready (+)

[*] -down-> Instantiation : ASG scaling event; bootstrap
Instantiation -> Configure : successful bootstrap
Configure -> Configure : execute cloud-init
Configure -down-> Startup : bfd-server start
Startup -up[#red]-> Configure : internal health check failure\nbfd-server restart
Startup -down-> Started : internal health check success
Started -down-> [*]
@enduml

PlantUML version 1.2022.3(Tue Mar 29 11:10:57 CDT 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>