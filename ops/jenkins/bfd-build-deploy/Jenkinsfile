pipeline {
  agent {
    kubernetes {
      defaultContainer 'bfd-cbc-build'
      yaml """
apiVersion: v1
kind: Pod
spec:
  serviceAccount: bfd
  restartPolicy: Never
  containers:
    - name: bfd-cbc-build
      image: "public.ecr.aws/c2o1d8s9/bfd-cbc-build:jdk11-mvn3-an29-tfenv-aeaa61fa6"
      command:
        - cat
      tty: true
      imagePullPolicy: IfNotPresent
"""
    }
  }

  parameters {
        booleanParam(name: 'verbose_mvn_logging',
        description: 'When true, `mvn` will produce verbose logs.',
        defaultValue: false)
  }

  stages {
    stage('Run Build Apps') {
      steps {
        script {
          def jobToRun = "bfd-build-apps/${env.BRANCH_NAME}"

          build job: jobToRun, parameters: [string(name: "verbose_mvn_logging", value: "${params.verbose_mvn_logging}")], wait: false
        }
      }
    }
  }
}
