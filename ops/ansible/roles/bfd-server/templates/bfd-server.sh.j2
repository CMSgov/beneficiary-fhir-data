#!/bin/bash

# The launcher picks up its config from environment variables, so set those.
export PORT='{{ data_server_appserver_https_port }}'
export KEYSTORE='{{ data_server_dir }}/bluebutton-appserver-keystore.jks'
export TRUSTSTORE='{{ data_server_dir }}/bluebutton-appserver-truststore.jks'
export WAR='{{ data_server_dir }}/{{ data_server_war | basename }}'

# The WAR picks up its config from Java system properties, so set some variables we can use for
# those.
DB_URL='{{ data_server_db_url }}'
DB_USERNAME='{{ data_server_db_username }}'
DB_PASSWORD='{{ data_server_db_password }}'
DB_MAX_CONNECTIONS='{{ data_server_db_max_connections }}'

# Set some additional variables.
JVM_ARGS='{{ data_server_appserver_jvmargs }}'

# 3... 2... 1... launch!
java \
  ${JVM_ARGS} \
  "-DbfdServer.db.url=${DB_URL}" \
  "-DbfdServer.db.username=${DB_USERNAME}" \
  "-DbfdServer.db.password=${DB_PASSWORD}" \
  "-DbfdServer.db.connections.max=${DB_MAX_CONNECTIONS}" \
  -jar "{{ data_server_dir }}/{{ data_server_launcher | basename }}" \
  >>"{{ data_server_dir }}/bluebutton-server-app-log.json" 2>&1
