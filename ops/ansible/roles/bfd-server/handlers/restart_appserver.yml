---

##
# Restarts the BFD Server service and waits for it to start accepting connections again afterwards.
##

# Silly, but prevents Ansible from reporting that the handler is missing when launch_enabled isn't
# true.
- name: Report Restart Service Enablement
  debug:
    msg: "Restart service?: {{ launch_enabled | default(false) }}"

- name: Restart and Wait for BFD Server Service
  block:
    - name: Restart BFD Server Service
      service:
        name: "{{ data_server_appserver_service }}"
        state: restarted
      become: true
    - name: Wait for BFD Server Service Ready
      wait_for:
        port: "{{ data_server_appserver_https_port }}"
        timeout: 30
  when: launch_enabled | default(false)
