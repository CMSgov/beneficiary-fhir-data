{
  "metrics": {
    "namespace": "bfd-{{ env }}/bfd-server/CWAgent",
    "metrics_collected": {
      "collectd": {},
      "cpu": {
        "resources": [
          "*"
        ],
        "measurement": [{
            "name": "cpu_usage_idle",
            "rename": "CPU_USAGE_IDLE",
            "unit": "Percent"
          },
          {
            "name": "cpu_usage_nice",
            "unit": "Percent"
          },
          "cpu_usage_guest"
        ],
        "totalcpu": false,
        "metrics_collection_interval": 10,
        "append_dimensions": {
          "test": "test1",
          "date": "2017-10-01"
        }
      },
      "netstat": {
        "measurement": [
          "tcp_established",
          "tcp_syn_sent",
          "tcp_close"
        ],
        "metrics_collection_interval": 60
      },
      "disk": {
        "measurement": [
          "used_percent"
        ],
        "resources": [
          "*"
        ],
        "drop_device": true
      },
      "processes": {
        "measurement": [
          "running",
          "sleeping",
          "dead"
        ]
      }
    },
    "append_dimensions": {
      "ImageId": "${aws:ImageId}",
      "InstanceId": "${aws:InstanceId}",
      "InstanceType": "${aws:InstanceType}",
      "AutoScalingGroupName": "${aws:AutoScalingGroupName}"
    },
    "aggregation_dimensions": [
      ["AutoScalingGroupName"],
      ["InstanceId", "InstanceType"],
      []
    ]
  },
  "logs": {
    "logs_collected": {
      "files": {
        "collect_list": [{
            "file_path": "/var/log/messages",
            "log_group_name": "/bfd/{{ env }}/var/log/messages",
            "log_stream_name": "{instance_id}",
            "timestamp_format": "%b %d %H:%M:%S"
          },
          {
            "file_path": "/var/log/secure",
            "log_group_name": "/bfd/{{ env }}/var/log/secure",
            "log_stream_name": "{instance_id}",
            "timestamp_format": "%b %d %H:%M:%S"
          },
          {
            "file_path": "{{ bfd_server_dir }}/access.json",
            "log_group_name": "/bfd/{{ env }}/bfd-server/access.json",
            "log_stream_name": "{instance_id}",
            "timestamp_format": "%Y-%m-%dT%H:%M:%S%z"
          },
          {
            "file_path": "{{ bfd_server_dir }}/access.log",
            "log_group_name": "/bfd/{{ env }}/bfd-server/access.txt",
            "log_stream_name": "{instance_id}",
            "timestamp_format": "%d/%b/%Y:%H:%M:%S %z"
          },
          {
            "file_path": "{{ bfd_server_dir }}/bluebutton-server-app-log.json",
            "log_group_name": "/bfd/{{ env }}/bfd-server/messages.json",
            "log_stream_name": "{instance_id}",
            "timestamp_format": "%Y-%m-%dT%H:%M:%S%z"
          },
          {
            "file_path": "{{ bfd_server_dir }}/gc.log",
            "log_group_name": "/bfd/{{ env }}/bfd-server/gc.log",
            "log_stream_name": "{instance_id}",
            "timestamp_format": "%Y-%m-%dT%H:%M:%S%z",
            "multi_line_start_pattern": "^[\\d\\d\\d\\d-\\d\\d-\\d\\d ]"
          },
          {
            "file_path": "{{ bfd_server_dir }}/newrelic_agent.log",
            "log_group_name": "/bfd/{{ env }}/bfd-server/newrelic_agent.log",
            "log_stream_name": "{instance_id}",
            "timestamp_format": "%b %d, %Y %H:%M:%S %z"
          },
          {
            "file_path": "{{ bfd_server_dir }}/bfd-server-startup.log",
            "log_group_name": "/bfd/{{ env }}/bfd-server/bfd-server-startup.log",
            "log_stream_name": "{instance_id}",
            "timestamp_format": "%Y-%m-%d %H:%M:%S"
          },
          {
            "file_path": "{{ bfd_server_dir }}/loadedFilterManagerLog.json",
            "log_group_name": "/bfd/{{ env }}/bfd-server/loadedFilterManagerLog.log",
            "log_stream_name": "{instance_id}",
            "timestamp_format": "%Y-%m-%d %H:%M:%S"
          }
        ]
      }
    },
    "metrics_collected": {
      "prometheus": {
        "cluster_name": "/bfd/{{ env }}/bfd-server",
        "log_group_name": "/bfd/{{ env }}/bfd-server/prometheus",
        "prometheus_config_path": "/tmp/cwagent-prometheus.yaml",
        "emf_processor": {
          "metric_declaration_dedup": true,
          "metric_namespace": "/bfd-{{ env }}/bfd-server/prometheus",
          "metric_unit": {
            "jvm_threads_current": "Count",
            "jvm_classes_loaded": "Count",
            "java_lang_operatingsystem_freephysicalmemorysize": "Bytes",
            "catalina_manager_activesessions": "Count",
            "jvm_gc_collection_seconds_sum": "Seconds",
            "catalina_globalrequestprocessor_bytesreceived": "Bytes",
            "jvm_memory_bytes_used": "Bytes",
            "jvm_memory_pool_bytes_used": "Bytes"
          },
          "metric_declaration": [
            {
              "source_labels": ["job"],
              "label_matcher": "^jmx$",
              "dimensions": [["instance"]],
              "metric_selectors": [
                "^jvm_threads_current$",
                "^jvm_classes_loaded$",
                "^java_lang_operatingsystem_freephysicalmemorysize$",
                "^catalina_manager_activesessions$",
                "^jvm_gc_collection_seconds_sum$",
                "^catalina_globalrequestprocessor_bytesreceived$"
              ]
            },
            {
              "source_labels": ["job"],
              "label_matcher": "^jmx$",
              "dimensions": [["area"]],
              "metric_selectors": [
                "^jvm_memory_bytes_used$"
              ]
            },
            {
              "source_labels": ["job"],
              "label_matcher": "^jmx$",
              "dimensions": [["pool"]],
              "metric_selectors": [
                "^jvm_memory_pool_bytes_used$"
                "^jvm_buffer_pool_used_bytes$"
              ]
            }
          ]
        }
      }
    }
  }
}