---
##
# Configures the BFD DB Migrator Service for CCS env
##
- name: Configure DB Migrator Server
  hosts: all
  become: true
  remote_user: ec2-user
  gather_facts: yes
  vars:
    ansible_ssh_pipelining: no
    bfd_migrator_dir: /opt/bfd-db-migrator

  tasks:
    - name: Apply base Cloudwatch Agent Role
      import_role:
        name: cloudwatch-agent-instrumented

    - name: Apply latest host security patches
      import_role:
        name: base_patch

    - name: Apply DB Migrator Role
      import_role:
        name: bfd-db-migrator
      vars:
        db_migrator_dir: "{{ bfd_migrator_dir }}"
        db_migrator_tmp_dir: "{{ bfd_migrator_dir }}/tmp"
